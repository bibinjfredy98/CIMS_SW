{% extends 'base1.html' %}

{% load static %}
{% get_static_prefix as static %}

{% block content %}

    <div class="container-fluid flex-grow-1 container-p-y">
        <h4 class="py-0 mb-3">Configuration</h4>
        <div class="row">
            <div class="col-md-12">
                <div class="nav-align-top nav-tabs-shadow mb-4">
                    <div class="tab-content">


                        <div id="CombinedContent" class="mx-4 my-3">

                            <div class="col-lg-12">
                                
                                <div class="demo-inline-spacing mt-3 px-0">
                                    

                                    <div class="tab-content px-0 mt-3">

                                       
                                        <div class="list-group list-group-horizontal-md text-md-center">

                                            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-center animated-tab"
                                               id="cluster-config-tab"
                                               data-bs-toggle="list"
                                               href="#subadmin-config">
                                               <i class="fas fa-user fa-lg"></i>
                                               <span class="ms-2 fw-bold">Users</span>
                                            </a> 
                                        
                                            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-center animated-tab"
                                               id="cluster-config-tab"
                                               data-bs-toggle="list"
                                               href="#cluster-config">
                                               <i class="fas fa-network-wired fa-lg"></i>
                                               <span class="ms-2 fw-bold">Cluster</span>
                                            </a> 
                                        
                                            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-center animated-tab"
                                               id="building-config-tab"
                                               data-bs-toggle="list"
                                               href="#building-config">
                                               <i class="fas fa-building fa-lg"></i>
                                               <span class="ms-2 fw-bold">Room</span>
                                            </a>
                                        
                                            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-center animated-tab"
                                               id="room-config-tab"
                                               data-bs-toggle="list"
                                               href="#room-config">
                                               <i class="fas fa-microchip fa-lg"></i>
                                               <span class="ms-2 fw-bold">Device</span>
                                            </a>
                                        
                                            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-center animated-tab"
                                               id="alert-config-tab"
                                               data-bs-toggle="list"
                                               href="#alert-config">
                                               <i class="fas fa-exclamation-triangle fa-lg"></i>
                                               <span class="ms-2 fw-bold">Alert</span>
                                            </a>
                                        
                                            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-center animated-tab"
                                               id="mqtt-device-tab"
                                               data-bs-toggle="list"
                                               href="#mqtt-device">
                                               <i class="fas fa-bell fa-lg"></i>
                                               <span class="ms-2 fw-bold">Alarm</span>
                                            </a>
                                        
                                            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-center animated-tab"
                                               id="gsm-module-tab"
                                               data-bs-toggle="list"
                                               href="#gsm-module">
                                               <i class="fas fa-envelope fa-lg"></i>
                                               <span class="ms-2 fw-bold">Message</span>
                                            </a>
                                        
                                            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-center animated-tab"
                                               id="alert-config-tab"
                                               data-bs-toggle="list"
                                               href="#Power-module">
                                               <i class="fas fa-bolt fa-lg"></i>
                                               <span class="ms-2 fw-bold">Power</span>
                                            </a>  
                                            





                                        </div>
                                        
                                        
                                        <div class="tab-pane fade" id="subadmin-config">
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>User Configuration</h5>
                                                </div>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <hr>
                                                    <table class="table">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>User Name</th>
                                                                <th>Assigned Rooms</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for subadmin in approved_sub_admins %}
                                                            <tr data-sub-admin-id="{{ subadmin.id }}">
                                                                <td>{{ subadmin.custom_id }}</td>
                                                                <td>{{ subadmin.username }}</td>
                                                                <td class="buildings-list">
                                                                    {% for building in subadmin.building.all %}
                                                                        {{ building.name }}{% if not forloop.last %}, {% endif %}
                                                                    {% endfor %}
                                                                </td>
                                                                <td>
                                                                    <button class="btn btn-primary assign-buildings-btn" data-bs-toggle="modal" data-bs-target="#assignBuildingsModal" data-subadmin-id="{{ subadmin.id }}">Assign Rooms</button>
                                                                    <form action="{% url 'delete_sub_admin' subadmin.id %}" method="post" style="display:inline;">
                                                                        {% csrf_token %}
                                                                        <button type="submit" class="btn btn-danger">Delete</button>
                                                                    </form>
                                        
                                                                    <form action="{% url 'toggle_suspend_sub_admin' subadmin.id %}" method="post" style="display:inline;">
                                                                        {% csrf_token %}
                                                                        <button type="submit" class="btn btn-warning">
                                                                            {% if subadmin.suspended %} Unsuspend {% else %} Suspend {% endif %}
                                                                        </button>
                                                                    </form>
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    
                                                </div>
                                            </div>
                                        </div>

                                        

                                        <!-- Cluster Configuration -->

                                    
                                        <!-- <div class="tab-pane fade" id="cluster-config">
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>Cluster Configuration</h5>
                                                </div>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <div class="d-flex justify-content-end p-1 px-1 py-0 mt-3 mb-1">
                                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClusterModal">
                                                            Add Cluster
                                                        </button>
                                                    </div>
                                                    <hr>
                                                    <table class="datatables-basic table">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>Cluster Name</th>
                                                                <th>Description</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for cluster in clusters %}
                                                                <tr data-cluster-id="{{ cluster.id }}">
                                                                    <td>{{ cluster.custom_id }}</td>
                                                                    <td data-field="name">{{ cluster.name }}</td>
                                                                    <td data-field="description">{{ cluster.description }}</td>
                                                                    <td>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#viewClusterModal{{ cluster.id }}">
                                                                            <i class="fas fa-eye"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editClusterModal{{ cluster.id }}">
                                                                            <i class="fas fa-edit"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteClusterModal{{ cluster.id }}">
                                                                            <i class="fas fa-trash-alt"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    
                                                </div>
                                            </div>
                                        </div> -->
                                        <div class="tab-pane fade" id="cluster-config">
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>Cluster Configuration</h5>
                                                </div>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <div class="d-flex justify-content-end p-1 px-1 py-0 mt-3 mb-1">
                                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClusterModal">
                                                            Add Cluster
                                                        </button>
                                                    </div>
                                                    <hr>
                                                    <table class="datatables-basic table">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>Cluster Name</th>
                                                                <th>Description</th>
                                                                <th>Buildings</th>
                                                                <th>Rooms</th>
                                                                <th>Sub Admins</th>
                                                                <th>Main Admins</th>
                                                                <th>Power Modules</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for cluster in clusters %}
                                                                <tr data-cluster-id="{{ cluster.id }}">
                                                                    <td>{{ cluster.custom_id }}</td>
                                                                    <td data-field="name">{{ cluster.name }}</td>
                                                                    <td data-field="description">{{ cluster.description }}</td>
                                                                    <td>
                                                                        {% for building in cluster.buildings.all %}
                                                                            <span>{{ building.name }}</span><br>
                                                                        {% endfor %}
                                                                    </td>
                                                                    <td>
                                                                        {% for room in cluster.rooms.all %}
                                                                            <span>{{ room.name }}</span><br>
                                                                        {% endfor %}
                                                                    </td>
                                                                    <td>
                                                                        {% for sub_admin in cluster.sub_admins.all %}
                                                                            <span>{{ sub_admin.username }}</span><br>
                                                                        {% endfor %}
                                                                    </td>
                                                                    <td>
                                                                        {% for main_admin in cluster.main_admins.all %}
                                                                            <span>{{ main_admin.username }}</span><br>
                                                                        {% endfor %}
                                                                    </td>
                                                                    <td>
                                                                        {% for power_module in cluster.power_modules.all %}
                                                                            <span>{{ power_module.name }}</span><br>
                                                                        {% endfor %}
                                                                    </td>
                                                                    <td>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#viewClusterModal{{ cluster.id }}">
                                                                            <i class="fas fa-eye"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editClusterModal{{ cluster.id }}">
                                                                            <i class="fas fa-edit"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteClusterModal{{ cluster.id }}">
                                                                            <i class="fas fa-trash-alt"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    

                                        <!-- Building Configuration -->
                                        <!-- Building Configuration -->
                                        <div class="tab-pane fade" id="building-config">
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>Room Configuration</h5>
                                                </div>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <div class="d-flex justify-content-end p-1 px-1 py-0 mt-3 mb-1">
                                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBuildingModal">
                                                            Add Room
                                                        </button>
                                                    </div>
                                                    <hr>
                                                    <table class="datatables-basic table">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>Room Name</th>
                                                                <th>Devices</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for building in buildings %}
                                                                <tr data-building-id="{{ building.id }}">
                                                                    <td>{{ building.custom_id }}</td>
                                                                    <td>{{ building.name }}</td>
                                                                    <td>
                                                                        {% for room in building.rooms.all %}
                                                                            {{ room.name }}<br>
                                                                        {% endfor %}
                                                                    </td>
                                                                    <td>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editBuildingModal{{ building.id }}">
                                                                            <i class="fas fa-edit"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteBuildingModal{{ building.id }}">
                                                                            <i class="fas fa-trash-alt"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Room Configuration -->
                                        <!-- Room Configuration -->
                                        <div class="tab-pane fade" id="room-config">
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>Device Configuration</h5>
                                                </div>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <div class="d-flex justify-content-end p-1 px-1 py-0 mt-3 mb-1">
                                                        <div class="col-md-3.5 d-flex align-items-center">
                                                            
                                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRoomModal">
                                                                Add Device
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <hr>
                                                    <table class="datatables-basic table">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>Device Name</th>
                                                                <th>IP Address</th>
                                                                <th>Topic Name</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for room in rooms %}
                                                                <tr data-room-id="{{ room.id }}">
                                                                    <td>{{ room.custom_id }}</td>
                                                                    <td data-field="name">{{ room.name }}</td>
                                                                    <td data-field="ip_address">{{ room.ip_address }}</td>
                                                                    <td data-field="topic_name">{{ room.topic_name }}</td>
                                                                    <td>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#viewRoomModal{{ room.id }}">
                                                                            <i class="fas fa-eye"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editRoomModal{{ room.id }}">
                                                                            <i class="fas fa-edit"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteRoomModal{{ room.id }}">
                                                                            <i class="fas fa-trash-alt"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>


                                        <!-- Alert Configuration -->
                                        

                                        <div class="tab-pane fade" id="alert-config">
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>Alert Configuration</h5>
                                                </div>
                                                <hr>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <table class="datatables-basic table table-hover table-striped">
                                                        <thead class="thead-dark">
                                                          
                                                            <tr>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-id-badge"></i><br>
                                                                        ID
                                                                    </div>
                                                                </th>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-microchip"></i><br>
                                                                        Device Name
                                                                    </div>
                                                                </th>


                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-bell"></i><br>
                                                                        Alert Device
                                                                    </div>
                                                                </th>


                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-thermometer-half"></i><br>
                                                                        Temperature Threshold
                                                                    </div>
                                                                </th>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-tint"></i><br>
                                                                        Humidity Threshold
                                                                    </div>
                                                                </th>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-running"></i><br>
                                                                        Motion Sensor
                                                                    </div>
                                                                </th>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-door-open"></i><br>
                                                                        Door Sensor
                                                                    </div>
                                                                </th>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-water"></i><br>
                                                                        Flood Sensor
                                                                    </div>
                                                                </th>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-smog"></i><br>
                                                                        Smoke Sensor
                                                                    </div>
                                                                </th>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-signal"></i><br>
                                                                        GSM Sensor
                                                                    </div>
                                                                </th>
                                                                <th>
                                                                    <div style="text-align: center;">
                                                                        <i class="fas fa-clock"></i><br>
                                                                        Time Interval
                                                                    </div>
                                                                </th>
                                                            </tr>
                                                            
                                                            
                                                            
                                                        </thead>
                                                        <tbody>
                                                            {% for room in rooms %}
                                                            <tr>
                                                                <td>{{ room.custom_id }}</td>
                                                                <td>{{ room.name }}</td>
                                                                <td>
                                                                    <select class="form-select mqtt-device-dropdown" data-room-id="{{ room.id }}">
                                                                        <option value="">Select MQTT Device</option>
                                                                        {% for device in mqtt_devices %}
                                                                        <option value="{{ device.id }}" {% if device in room.alert_mqtt_device.all %}selected{% endif %}>
                                                                            {{ device.name }}
                                                                        </option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </td>
                                                                
                                                                
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <span>{{ room.temperature_threshold }}</span>
                                                                        <button class="btn btn-sm ms-2" data-bs-toggle="modal" data-bs-target="#editThresholdModal" data-id="{{ room.id }}" data-type="temperature" data-value="{{ room.temperature_threshold }}">
                                                                            <i class="fas fa-edit"></i>
                                                                        </button>
                                                                    </div>
                                                                    <select class="form-select mt-2 color-alert-dropdown" data-id="{{ room.id }}" data-type="temperature">
                                                                        <option value="">Select Alert Color</option>
                                                                        <option value="1" {% if room.temperature_alerts == '1' %}selected{% endif %}>Red Light</option>
                                                                        <option value="2" {% if room.temperature_alerts == '2' %}selected{% endif %}>Green Light</option>
                                                                        <option value="3" {% if room.temperature_alerts == '3' %}selected{% endif %}>Blue Light</option>
                                                                        <option value="4" {% if room.temperature_alerts == '4' %}selected{% endif %}>Yellow Light</option>
                                                                        <option value="6" {% if room.temperature_alerts == '6' %}selected{% endif %}>Siren</option>
                                                                        <option value="7" {% if room.temperature_alerts == '7' %}selected{% endif %}>Buzzer</option>
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <span>{{ room.humidity_threshold }}</span>
                                                                        <button class="btn btn-sm ms-2" data-bs-toggle="modal" data-bs-target="#editThresholdModal" data-id="{{ room.id }}" data-type="humidity" data-value="{{ room.humidity_threshold }}">
                                                                            <i class="fas fa-edit"></i>
                                                                        </button>
                                                                    </div>
                                                                    <select class="form-select mt-2 color-alert-dropdown" data-id="{{ room.id }}" data-type="humidity">
                                                                        <option value="">Select Alert Color</option>
                                                                        <option value="1" {% if room.humidity_alerts == '1' %}selected{% endif %}>Red Light</option>
                                                                        <option value="2" {% if room.humidity_alerts == '2' %}selected{% endif %}>Green Light</option>
                                                                        <option value="3" {% if room.humidity_alerts == '3' %}selected{% endif %}>Blue Light</option>
                                                                        <option value="4" {% if room.humidity_alerts == '4' %}selected{% endif %}>Yellow Light</option>
                                                                        <option value="6" {% if room.humidity_alerts == '6' %}selected{% endif %}>Siren</option>
                                                                        <option value="7" {% if room.humidity_alerts == '7' %}selected{% endif %}>Buzzer</option>
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <!-- <input type="checkbox" class="form-check-input sensor-switch" data-id="{{ room.id }}" data-type="pir_state_threshold" {% if room.pir_state_threshold == 'enabled' %}checked{% endif %}> -->
                                                                        <div class="form-check form-switch">
                                                                            <input type="checkbox" id="sensorSwitch{{ room.id }}" class="form-check-input sensor-switch" data-id="{{ room.id }}" data-type="pir_state_threshold" {% if room.pir_state_threshold == 'enabled' %}checked{% endif %}>
                                                                            <!-- <label class="form-check-label" for="sensorSwitch{{ room.id }}">Toggle</label> -->
                                                                        </div>
                                                                        
                                                                        <select class="form-select mt-2 ms-2 color-alert-dropdown" data-id="{{ room.id }}" data-type="pir_state">
                                                                            <option value="">Select Alert Color</option>
                                                                            <option value="1" {% if room.pir_alerts == '1' %}selected{% endif %}>Red Light</option>
                                                                            <option value="2" {% if room.pir_alerts == '2' %}selected{% endif %}>Green Light</option>
                                                                            <option value="3" {% if room.pir_alerts == '3' %}selected{% endif %}>Blue Light</option>
                                                                            <option value="4" {% if room.pir_alerts == '4' %}selected{% endif %}>Yellow Light</option>
                                                                            <option value="6" {% if room.pir_alerts == '6' %}selected{% endif %}>Siren</option>
                                                                            <option value="7" {% if room.pir_alerts == '7' %}selected{% endif %}>Buzzer</option>
                                                                        </select>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <!-- <input type="checkbox" class="form-check-input sensor-switch" data-id="{{ room.id }}" data-type="door_state_threshold" {% if room.door_state_threshold == 'enabled' %}checked{% endif %}> -->
                                                                        <div class="form-check form-switch">
                                                                            <input type="checkbox" id="sensorSwitch{{ room.id }}" class="form-check-input sensor-switch" data-id="{{ room.id }}" data-type="door_state_threshold" {% if room.door_state_threshold == 'enabled' %}checked{% endif %}>
                                                                            <!-- <label class="form-check-label" for="sensorSwitch{{ room.id }}">Toggle</label> -->
                                                                        </div>
                                                                        <select class="form-select mt-2 ms-2 color-alert-dropdown" data-id="{{ room.id }}" data-type="door_state">
                                                                            <option value="">Select Alert Color</option>
                                                                            <option value="1" {% if room.door_alerts == '1' %}selected{% endif %}>Red Light</option>
                                                                            <option value="2" {% if room.door_alerts == '2' %}selected{% endif %}>Green Light</option>
                                                                            <option value="3" {% if room.door_alerts == '3' %}selected{% endif %}>Blue Light</option>
                                                                            <option value="4" {% if room.door_alerts == '4' %}selected{% endif %}>Yellow Light</option>
                                                                            <option value="6" {% if room.door_alerts == '6' %}selected{% endif %}>Siren</option>
                                                                            <option value="7" {% if room.door_alerts == '7' %}selected{% endif %}>Buzzer</option>
                                                                        </select>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <!-- <input type="checkbox" class="form-check-input sensor-switch" data-id="{{ room.id }}" data-type="flood_state_threshold" {% if room.flood_state_threshold == 'enabled' %}checked{% endif %}> -->
                                                                        <div class="form-check form-switch">
                                                                            <input type="checkbox" id="sensorSwitch{{ room.id }}" class="form-check-input sensor-switch" data-id="{{ room.id }}" data-type="flood_state_threshold" {% if room.flood_state_threshold == 'enabled' %}checked{% endif %}>
                                                                            <!-- <label class="form-check-label" for="sensorSwitch{{ room.id }}">Toggle</label> -->
                                                                        </div>
                                                                        <select class="form-select mt-2 ms-2 color-alert-dropdown" data-id="{{ room.id }}" data-type="flood_state">
                                                                            <option value="">Select Alert Color</option>
                                                                            <option value="1" {% if room.flood_alerts == '1' %}selected{% endif %}>Red Light</option>
                                                                            <option value="2" {% if room.flood_alerts == '2' %}selected{% endif %}>Green Light</option>
                                                                            <option value="3" {% if room.flood_alerts == '3' %}selected{% endif %}>Blue Light</option>
                                                                            <option value="4" {% if room.flood_alerts == '4' %}selected{% endif %}>Yellow Light</option>
                                                                            <option value="6" {% if room.flood_alerts == '6' %}selected{% endif %}>Siren</option>
                                                                            <option value="7" {% if room.flood_alerts == '7' %}selected{% endif %}>Buzzer</option>
                                                                        </select>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <!-- <input type="checkbox" class="form-check-input sensor-switch" data-id="{{ room.id }}" data-type="gas_state_threshold" {% if room.gas_state_threshold == 'enabled' %}checked{% endif %}> -->
                                                                        <div class="form-check form-switch">
                                                                            <input type="checkbox" id="sensorSwitch{{ room.id }}" class="form-check-input sensor-switch" data-id="{{ room.id }}" data-type="gas_state_threshold" {% if room.gas_state_threshold == 'enabled' %}checked{% endif %}>
                                                                            <!-- <label class="form-check-label" for="sensorSwitch{{ room.id }}">Toggle</label> -->
                                                                        </div>
                                                                        <select class="form-select mt-2 ms-2 color-alert-dropdown" data-id="{{ room.id }}" data-type="gas_state">
                                                                            <option value="">Select Alert Color</option>
                                                                            <option value="1" {% if room.gas_alerts == '1' %}selected{% endif %}>Red Light</option>
                                                                            <option value="2" {% if room.gas_alerts == '2' %}selected{% endif %}>Green Light</option>
                                                                            <option value="3" {% if room.gas_alerts == '3' %}selected{% endif %}>Blue Light</option>
                                                                            <option value="4" {% if room.gas_alerts == '4' %}selected{% endif %}>Yellow Light</option>
                                                                            <option value="6" {% if room.gas_alerts == '6' %}selected{% endif %}>Siren</option>
                                                                            <option value="7" {% if room.gas_alerts == '7' %}selected{% endif %}>Buzzer</option>
                                                                        </select>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <input type="checkbox" class="form-check-input gsm-switch" data-id="{{ room.id }}" data-type="gsm_alert" {% if room.gsm_alert == 'enabled' %}checked{% endif %}>
                                                                        <select class="form-select mt-2 ms-2 gsm-number-dropdown" data-id="{{ room.id }}" style="display: none;">
                                                                            <option value="">Select Number</option>
                                                                            {% for module in gsm_modules %}
                                                                            {% for number in module.numbers %}
                                                                            <option value="{{ number }}">{{ number }}</option>
                                                                            {% endfor %}
                                                                            {% endfor %}
                                                                        </select>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <input type="number" class="form-control interval-input" data-id="{{ room.id }}" value="{{ room.interval }}">
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        
                                        

                                        



                                        <!-- MQTT Device Configuration -->
                                        <div class="tab-pane fade" id="mqtt-device">
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>Alarm Device Configuration</h5>
                                                </div>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <div class="d-flex justify-content-end p-1 px-1 py-0 mt-3 mb-1">
                                                        <div class="btn-group me-2">
                                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMqttDeviceModal">
                                                                Add Alarm Device
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <hr>
                                                    <table class="datatables-basic table">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>Device Name</th>
                                                                <th>IP Address</th>
                                                                <th>Topic Name</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for device in mqtt_devices %}
                                                                <tr>
                                                                    <td>{{ device.custom_id }}</td>
                                                                    <td>{{ device.name }}</td>
                                                                    <td>{{ device.ip_address }}</td>
                                                                    <td>{{ device.topic_name }}</td>
                                                                    <td>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#viewMqttDeviceModal" data-id="{{ device.id }}">
                                                                            <i class="fas fa-eye"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editMqttDeviceModal" data-id="{{ device.id }}">
                                                                            <i class="fas fa-edit"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteMqttDeviceModal" data-id="{{ device.id }}">
                                                                            <i class="fas fa-trash"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- GSM Module Configuration -->
                                        <div class="tab-pane fade" id="gsm-module">
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>GSM Module Configuration</h5>
                                                </div>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <div class="d-flex justify-content-end p-1 px-1 py-0 mt-3 mb-1">
                                                        <div class="btn-group me-2">
                                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGsmModuleModal">
                                                                Add GSM Module
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <hr>
                                                    <table class="datatables-basic table">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>Module Name</th>
                                                                <th>IP Address</th>
                                                                <th>Topic Name</th>
                                                                <th>Numbers</th>

                                                                <th>Users</th>


                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for module in gsm_modules %}
                                                                <tr>
                                                                    <td>{{ module.custom_id }}</td>
                                                                    <td>{{ module.module_name }}</td>
                                                                    <td>{{ module.ip_address }}</td>
                                                                    <td>{{ module.topic_name }}</td>
                                                                    <td>{{ module.numbers }}</td>

                                                                    <td>{{ module.mobile_username }}</td>


                                                                    <td>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#viewGsmModuleModal" data-id="{{ module.id }}">
                                                                            <i class="fas fa-eye"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editGsmModuleModal" data-id="{{ module.id }}">
                                                                            <i class="fas fa-edit"></i>
                                                                        </button>
                                                                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteGsmModuleModal" data-id="{{ module.id }}">
                                                                            <i class="fas fa-trash"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        

                                     
                                        <div class="tab-pane fade" id="Power-module"> 
                                            <div class="card mt-3">
                                                <div class="card-header">
                                                    <h5>Power Configuration</h5>
                                                </div>
                                                <div class="card-datatable table-responsive pt-0">
                                                    <div class="d-flex justify-content-end p-1 px-1 py-0 mt-3 mb-1">
                                                        <div class="col-md-3.5 d-flex align-items-center">
                                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addpowermodal">
                                                                Add Device
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <hr>
                                                    
                                                    <table class="datatables-basic table">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>Device Name</th>
                                                                <th>IP Address</th>
                                                                <th>Topic Name</th>
                                                                <th>Buildings</th>
                                                                <th>CT1 Name</th>
                                                                <th>CT2 Name</th>
                                                                <th>CT3 Name</th>
                                                                <th>CT4 Name</th>
                                                                <th>CT1</th>
                                                                <th>CT2</th>
                                                                <th>CT3</th>
                                                                <th>CT4</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for power_module in power_modules %}
                                                            <tr>
                                                                <td>{{ power_module.custom_id }}</td>
                                                                <td>{{ power_module.name }}</td>
                                                                <td>{{ power_module.ip_address }}</td>
                                                                <td>{{ power_module.topic_name }}</td>
                                                                <td>
                                                                    {% for building in power_module.buildings.all %}
                                                                        {{ building.name }}{% if not forloop.last %}, {% endif %}
                                                                    {% endfor %}
                                                                </td>
                                                                <td>{{ power_module.ct1correspondingname }}</td>
                                                                <td>{{ power_module.ct2correspondingname }}</td>
                                                                <td>{{ power_module.ct3correspondingname }}</td>
                                                                <td>{{ power_module.ct4correspondingname }}</td>
                                                                <td id="ct1-{{ power_module.id }}">-</td>
                                                                <td id="ct2-{{ power_module.id }}">-</td>
                                                                <td id="ct3-{{ power_module.id }}">-</td>
                                                                <td id="ct4-{{ power_module.id }}">-</td>
                                                                <td>
                                                                    <!-- View Button -->
                                                                    <button class="btn btn view-button" data-id="{{ power_module.id }}" data-bs-toggle="modal" data-bs-target="#viewpowerModal">
                                                                        <i class="fas fa-eye"></i> 
                                                                    </button>
                                        
                                                                    <!-- Edit Button -->
                                                                    <button class="btn btn edit-button" data-id="{{ power_module.id }}" data-bs-toggle="modal" data-bs-target="#editpowerModal">
                                                                        <i class="fas fa-edit"></i> 
                                                                    </button>
                                        
                                                                    <!-- Delete Button -->
                                                                    <button class="btn btn delete-button" data-id="{{ power_module.id }}" data-bs-toggle="modal" data-bs-target="#deletepowerModal">
                                                                        <i class="fas fa-trash"></i> 
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        
                                           
                                                <!-- Add Device Modal -->
                                                <!-- Add Device Modal -->
                                                <div class="modal fade" id="addpowermodal" tabindex="-1" aria-labelledby="addpowermodalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="addpowermodalLabel">Add Power Module</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <!-- <div class="modal-body">
                                                                <form id="add-power-module-form" method="post" action="{% url 'add_power_module' %}">
                                                                    {% csrf_token %}
                                                                    <div class="mb-3">
                                                                        <label for="name" class="form-label">Device Name</label>
                                                                        <input type="text" class="form-control" id="name" name="name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="topic_name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="topic_name" name="topic_name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="ip_address" name="ip_address" required>
                                                                    </div>
                                                                   
                                                                    <div class="mb-3">
                                                                        <label for="buildings" class="form-label">Select Buildings</label>
                                                                        <div id="buildings">
                                                                            {% for building in buildings %}
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" name="buildings" value="{{ building.id }}" id="building{{ building.id }}">
                                                                                    <label class="form-check-label" for="building{{ building.id }}">
                                                                                        {{ building.name }}
                                                                                    </label>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </form>
                                                            </div> -->
                                                            <div class="modal-body">
                                                                <form id="add-power-module-form" method="post" action="{% url 'add_power_module' %}">
                                                                    {% csrf_token %}
                                                                    <div class="mb-3">
                                                                        <label for="name" class="form-label">Device Name</label>
                                                                        <input type="text" class="form-control" id="name" name="name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="topic_name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="topic_name" name="topic_name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="ip_address" name="ip_address" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="ct1correspondingname" class="form-label">CT1 Corresponding Name</label>
                                                                        <input type="text" class="form-control" id="ct1correspondingname" name="ct1correspondingname" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="ct2correspondingname" class="form-label">CT2 Corresponding Name</label>
                                                                        <input type="text" class="form-control" id="ct2correspondingname" name="ct2correspondingname" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="ct3correspondingname" class="form-label">CT3 Corresponding Name</label>
                                                                        <input type="text" class="form-control" id="ct3correspondingname" name="ct3correspondingname" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="ct4correspondingname" class="form-label">CT4 Corresponding Name</label>
                                                                        <input type="text" class="form-control" id="ct4correspondingname" name="ct4correspondingname" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="buildings" class="form-label">Select Buildings</label>
                                                                        <div id="buildings">
                                                                            {% for building in buildings %}
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" name="buildings" value="{{ building.id }}" id="building{{ building.id }}">
                                                                                    <label class="form-check-label" for="building{{ building.id }}">{{ building.name }}</label>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                               
                                                


                                                <!-- View Modal -->
                                                <div class="modal fade" id="viewpowerModal" tabindex="-1" aria-labelledby="viewPowerModuleLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="viewPowerModuleLabel">View Power Module</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <dl class="row">
                                                                    <dt class="col-sm-3">ID</dt>
                                                                    <dd class="col-sm-9" id="view-id"></dd>
                                                                    <dt class="col-sm-3">Device Name</dt>
                                                                    <dd class="col-sm-9" id="view-name"></dd>
                                                                    <dt class="col-sm-3">IP Address</dt>
                                                                    <dd class="col-sm-9" id="view-ip-address"></dd>
                                                                    <dt class="col-sm-3">Topic Name</dt>
                                                                    <dd class="col-sm-9" id="view-topic-name"></dd>
                                                                    <dt class="col-sm-3">CT1</dt>
                                                                    <dd class="col-sm-9" id="view-ct1"></dd>
                                                                    <dt class="col-sm-3">CT2</dt>
                                                                    <dd class="col-sm-9" id="view-ct2"></dd>
                                                                    <dt class="col-sm-3">CT3</dt>
                                                                    <dd class="col-sm-9" id="view-ct3"></dd>
                                                                    <dt class="col-sm-3">CT4</dt>
                                                                    <dd class="col-sm-9" id="view-ct4"></dd>
                                                                </dl>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Edit Modal -->
                                                <!-- <div class="modal fade" id="editpowerModal" tabindex="-1" aria-labelledby="editPowerModuleLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editPowerModuleLabel">Edit Power Module</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <form id="edit-power-form" method="post">
                                                                {% csrf_token %}
                                                                <div class="modal-body">
                                                                    <input type="hidden" id="edit-id" name="id">
                                                                    <div class="mb-3">
                                                                        <label for="edit-name" class="form-label">Device Name</label>
                                                                        <input type="text" class="form-control" id="edit-name" name="name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-ip-address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="edit-ip-address" name="ip_address" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-topic-name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="edit-topic-name" name="topic_name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-buildings" class="form-label">Select Buildings</label>
                                                                        <div id="edit-buildings">
                                                                            {% for building in buildings %}
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" name="buildings" value="{{ building.id }}" id="edit-building{{ building.id }}">
                                                                                    <label class="form-check-label" for="edit-building{{ building.id }}">
                                                                                        {{ building.name }}
                                                                                    </label>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div> -->
                                                <div class="modal fade" id="editpowerModal" tabindex="-1" aria-labelledby="editPowerModuleLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editPowerModuleLabel">Edit Power Module</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <form id="edit-power-form" method="post">
                                                                {% csrf_token %}
                                                                <div class="modal-body">
                                                                    <input type="hidden" id="edit-id" name="id">
                                                                    <div class="mb-3">
                                                                        <label for="edit-name" class="form-label">Device Name</label>
                                                                        <input type="text" class="form-control" id="edit-name" name="name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-ip-address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="edit-ip-address" name="ip_address" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-topic-name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="edit-topic-name" name="topic_name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-ct1-name" class="form-label">CT1 Name</label>
                                                                        <input type="text" class="form-control" id="edit-ct1-name" name="ct1correspondingname">
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-ct2-name" class="form-label">CT2 Name</label>
                                                                        <input type="text" class="form-control" id="edit-ct2-name" name="ct2correspondingname">
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-ct3-name" class="form-label">CT3 Name</label>
                                                                        <input type="text" class="form-control" id="edit-ct3-name" name="ct3correspondingname">
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-ct4-name" class="form-label">CT4 Name</label>
                                                                        <input type="text" class="form-control" id="edit-ct4-name" name="ct4correspondingname">
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit-buildings" class="form-label">Select Buildings</label>
                                                                        <div id="edit-buildings">
                                                                            {% for building in buildings %}
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" name="buildings" value="{{ building.id }}" id="edit-building{{ building.id }}">
                                                                                    <label class="form-check-label" for="edit-building{{ building.id }}">
                                                                                        {{ building.name }}
                                                                                    </label>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                

                                                <!-- Delete Modal -->
                                                <div class="modal fade" id="deletepowerModal" tabindex="-1" aria-labelledby="deletePowerModuleLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="deletePowerModuleLabel">Delete Power Module</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p>Are you sure you want to delete this power module?</p>
                                                                <form id="delete-power-form" method="post">
                                                                    {% csrf_token %}
                                                                    <input type="hidden" id="delete-id" name="id">
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" class="btn btn-danger">Delete</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                
                                                                                                

                                        

                                        

                                               
                                                                                        





                                                <!-- Edit Threshold Modal -->
                                                <div class="modal fade" id="editThresholdModal" tabindex="-1" aria-labelledby="editThresholdModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editThresholdModalLabel">Edit Threshold</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <form id="editThresholdForm">
                                                                <div class="modal-body">
                                                                    <input type="hidden" id="roomId" name="room_id">
                                                                    <input type="hidden" id="thresholdType" name="threshold_type">
                                                                    <div class="mb-3">
                                                                        <label for="thresholdValue" class="form-label">Threshold Value</label>
                                                                        <input type="number" class="form-control" id="thresholdValue" name="threshold_value">
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                

                                               


                                            









                                                <!-- Add Cluster Modal -->
                                                <!-- <div class="modal fade" id="addClusterModal" tabindex="-1" aria-labelledby="addClusterModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="addClusterModalLabel">Add Cluster</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <form id="addClusterForm" method="POST" action="{% url 'add_cluster' %}">
                                                                {% csrf_token %}
                                                                <div class="modal-body">
                                                                    <div class="mb-3">
                                                                        <label for="clusterName" class="form-label">Cluster Name</label>
                                                                        <input type="text" class="form-control" id="clusterName" name="name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterDescription" class="form-label">Description</label>
                                                                        <textarea class="form-control" id="clusterDescription" name="description"></textarea>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterRooms" class="form-label">Devices</label>
                                                                        <div class="form-check">
                                                                            {% for room in rooms %}
                                                                                <input class="form-check-input" type="checkbox" value="{{ room.id }}" id="room{{ room.id }}" name="rooms">
                                                                                <label class="form-check-label" for="room{{ room.id }}">
                                                                                    {{ room.name }}
                                                                                </label><br>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div> -->
                                                <!-- Add Cluster Modal -->
                                                <div class="modal fade" id="addClusterModal" tabindex="-1" aria-labelledby="addClusterModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="addClusterModalLabel">Add Cluster</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <form id="addClusterForm" method="POST" action="{% url 'add_cluster' %}">
                                                                {% csrf_token %}
                                                                <div class="modal-body">
                                                                    <div class="mb-3">
                                                                        <label for="clusterName" class="form-label">Cluster Name</label>
                                                                        <input type="text" class="form-control" id="clusterName" name="name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterDescription" class="form-label">Description</label>
                                                                        <textarea class="form-control" id="clusterDescription" name="description"></textarea>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterRooms" class="form-label">Rooms</label>
                                                                        <div class="form-check">
                                                                            {% for room in rooms %}
                                                                                <input class="form-check-input" type="checkbox" value="{{ room.id }}" id="room{{ room.id }}" name="rooms">
                                                                                <label class="form-check-label" for="room{{ room.id }}">{{ room.name }}</label><br>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    <!-- Add fields for buildings, power modules, and users -->
                                                                    <div class="mb-3">
                                                                        <label for="clusterBuildings" class="form-label">Buildings</label>
                                                                        <div class="form-check">
                                                                            {% for building in buildings %}
                                                                                <input class="form-check-input" type="checkbox" value="{{ building.id }}" id="building{{ building.id }}" name="buildings">
                                                                                <label class="form-check-label" for="building{{ building.id }}">{{ building.name }}</label><br>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterPowerModules" class="form-label">Power Modules</label>
                                                                        <div class="form-check">
                                                                            {% for power_module in power_modules %}
                                                                                <input class="form-check-input" type="checkbox" value="{{ power_module.id }}" id="power_module{{ power_module.id }}" name="power_modules">
                                                                                <label class="form-check-label" for="power_module{{ power_module.id }}">{{ power_module.name }}</label><br>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterAdmins" class="form-label">Main Admins</label>
                                                                        <div class="form-check">
                                                                            {% for main_admin in main_admins %}
                                                                                <input class="form-check-input" type="checkbox" value="{{ main_admin.id }}" id="main_admin{{ main_admin.id }}" name="main_admins">
                                                                                <label class="form-check-label" for="main_admin{{ main_admin.id }}">{{ main_admin.user.username }}</label><br>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterSubAdmins" class="form-label">Sub Admins</label>
                                                                        <div class="form-check">
                                                                            {% for sub_admin in sub_admins %}
                                                                                <input class="form-check-input" type="checkbox" value="{{ sub_admin.id }}" id="sub_admin{{ sub_admin.id }}" name="sub_admins">
                                                                                <label class="form-check-label" for="sub_admin{{ sub_admin.id }}">{{ sub_admin.username }}</label><br>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>

                                                                    



                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>


                                                <!-- Edit Cluster Modal -->
                                                {% for cluster in clusters %}
                                                <div class="modal fade" id="editClusterModal{{ cluster.id }}" tabindex="-1" aria-labelledby="editClusterModalLabel{{ cluster.id }}" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editClusterModalLabel{{ cluster.id }}">Edit Cluster</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <form id="editClusterForm{{ cluster.id }}" method="POST" action="{% url 'edit_cluster' cluster.id %}">
                                                                {% csrf_token %}
                                                                <div class="modal-body">
                                                                    <div class="mb-3">
                                                                        <label for="clusterName{{ cluster.id }}" class="form-label">Cluster Name</label>
                                                                        <input type="text" class="form-control" id="clusterName{{ cluster.id }}" name="name" value="{{ cluster.name }}" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterDescription{{ cluster.id }}" class="form-label">Description</label>
                                                                        <textarea class="form-control" id="clusterDescription{{ cluster.id }}" name="description">{{ cluster.description }}</textarea>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="clusterRooms{{ cluster.id }}" class="form-label">Devices</label>
                                                                        <div class="form-check">
                                                                            {% for room in rooms %}
                                                                                <input class="form-check-input" type="checkbox" value="{{ room.id }}" id="room{{ room.id }}{{ cluster.id }}" name="rooms" {% if room in cluster.rooms.all %}checked{% endif %}>
                                                                                <label class="form-check-label" for="room{{ room.id }}{{ cluster.id }}">
                                                                                    {{ room.name }}
                                                                                </label><br>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}

                                                <!-- View Cluster Modal -->
                                                {% for cluster in clusters %}
                                                <div class="modal fade" id="viewClusterModal{{ cluster.id }}" tabindex="-1" aria-labelledby="viewClusterModalLabel{{ cluster.id }}" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="viewClusterModalLabel{{ cluster.id }}">View Cluster</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p><strong>Name:</strong> {{ cluster.name }}</p>
                                                                <p><strong>Description:</strong> {{ cluster.description }}</p>
                                                                <p><strong>Device:</strong> {{ cluster.rooms.all|join:", " }}</p>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}

                                                <!-- Delete Cluster Modal -->
                                                {% for cluster in clusters %}
                                                <div class="modal fade" id="deleteClusterModal{{ cluster.id }}" tabindex="-1" aria-labelledby="deleteClusterModalLabel{{ cluster.id }}" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="deleteClusterModalLabel{{ cluster.id }}">Delete Cluster</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <form id="deleteClusterForm{{ cluster.id }}" method="POST" action="{% url 'delete_cluster' cluster.id %}">
                                                                {% csrf_token %}
                                                                <div class="modal-body">
                                                                    <p>Are you sure you want to delete this cluster?</p>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-danger">Delete</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}


                                        
<!------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                                <!-- Add Building Modal -->
                                                <!-- Add Building Modal (Move this outside the loop) -->
                                                <div class="modal fade" id="addBuildingModal" tabindex="-1" aria-labelledby="addBuildingModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="addBuildingModalLabel">Add Room</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <form id="addBuildingForm" method="POST" action="{% url 'add_building' %}">
                                                                {% csrf_token %}
                                                                <div class="modal-body">
                                                                    <div class="mb-3">
                                                                        <label for="buildingName" class="form-label">Room Name</label>
                                                                        <input type="text" class="form-control" id="buildingName" name="name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="buildingRooms" class="form-label">Devices</label>
                                                                        <div class="form-check">
                                                                            {% for room in rooms %}
                                                                                <input class="form-check-input" type="checkbox" value="{{ room.id }}" id="room{{ room.id }}" name="rooms">
                                                                                <label class="form-check-label" for="room{{ room.id }}">
                                                                                    {{ room.name }}
                                                                                </label><br>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Edit Building Modal -->
                                                {% for building in buildings %}
                                                    <div class="modal fade" id="editBuildingModal{{ building.id }}" tabindex="-1" aria-labelledby="editBuildingModalLabel{{ building.id }}" aria-hidden="true">
                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="editBuildingModalLabel{{ building.id }}">Edit Room</h5>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>
                                                                <form id="editBuildingForm{{ building.id }}" method="POST" action="{% url 'edit_building' building.id %}">
                                                                    {% csrf_token %}
                                                                    <div class="modal-body">
                                                                        <div class="mb-3">
                                                                            <label for="buildingName{{ building.id }}" class="form-label">Room Name</label>
                                                                            <input type="text" class="form-control" id="buildingName{{ building.id }}" name="name" value="{{ building.name }}" required>
                                                                        </div>
                                                                        <div class="mb-3">
                                                                            <label for="buildingRooms{{ building.id }}" class="form-label">Devices</label>
                                                                            <div class="form-check">
                                                                                {% for room in rooms %}
                                                                                    <input class="form-check-input" type="checkbox" value="{{ room.id }}" id="room{{ room.id }}{{ building.id }}" name="rooms" {% if room in building.rooms.all %}checked{% endif %}>
                                                                                    <label class="form-check-label" for="room{{ room.id }}{{ building.id }}">
                                                                                        {{ room.name }}
                                                                                    </label><br>
                                                                                {% endfor %}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary">Save changes</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endfor %}

                                                <!-- Delete Building Modal -->
                                                {% for building in buildings %}
                                                    <div class="modal fade" id="deleteBuildingModal{{ building.id }}" tabindex="-1" aria-labelledby="deleteBuildingModalLabel{{ building.id }}" aria-hidden="true">
                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="deleteBuildingModalLabel{{ building.id }}">Delete Room</h5>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>
                                                                <form id="deleteBuildingForm{{ building.id }}" method="POST" action="{% url 'delete_building' building.id %}">
                                                                    {% csrf_token %}
                                                                    <div class="modal-body">
                                                                        <p>Are you sure you want to delete this Room?</p>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-danger">Delete</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endfor %}



<!------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                                 <!-- room-device Modal ssssssssssssssssssssssssssssssssssssssssssssssss-->

                                                <!-- View Room Modal -->
                                                {% for room in rooms %}
                                                <div class="modal fade" id="viewRoomModal{{ room.id }}" tabindex="-1" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title">View Device</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p><strong>Name:</strong> {{ room.name }}</p>
                                                                <p><strong>IP Address:</strong> {{ room.ip_address }}</p>
                                                                <p><strong>Topic Name:</strong> {{ room.topic_name }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}

                                                <!-- Edit Room Modal -->
                                                {% for room in rooms %}
                                                <div class="modal fade" id="editRoomModal{{ room.id }}" tabindex="-1" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title">Edit Device</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="editRoomForm{{ room.id }}" method="post" action="{% url 'edit_room' room.id %}">
                                                                    {% csrf_token %}
                                                                    <div class="mb-3">
                                                                        <label for="id_name" class="form-label">Name</label>
                                                                        <input type="text" class="form-control" id="id_name" name="name" value="{{ room.name }}">
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="id_ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="id_ip_address" name="ip_address" value="{{ room.ip_address }}">
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="id_topic_name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="id_topic_name" name="topic_name" value="{{ room.topic_name }}">
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary">Save changes</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}

                                                <!-- Delete Room Modal -->
                                                {% for room in rooms %}
                                                <div class="modal fade" id="deleteRoomModal{{ room.id }}" tabindex="-1" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title">Delete Device</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p>Are you sure you want to delete this Device?</p>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <form id="deleteRoomForm{{ room.id }}" method="post" action="{% url 'delete_rooom' room.id %}">
                                                                    {% csrf_token %}
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-danger">Delete</button>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}

                                                <!-- Add Room Modal -->
                                                
                                                <div class="modal fade animate__animated fadeIn" id="addRoomModal" tabindex="-1" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="addRoomModalLabel">Add Device</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="addRoomForm" method="post" action="{% url 'add_room' %}">
                                                                    {% csrf_token %}
                                                                    <div class="mb-3">
                                                                        <label for="id_name" class="form-label">Name</label>
                                                                        <input type="text" class="form-control" id="id_name" name="name">
                                                                    </div>
                                                                    <!-- <div class="mb-3">
                                                                        <label for="id_ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="id_ip_address" name="ip_address">
                                                                    </div> -->
                                                                    <div class="mb-3">
                                                                        <label for="id_ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="id_ip_address" name="ip_address" pattern="((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" title="Please enter a valid IP address">
                                                                    </div>
                                                                    
                                                                    <div class="mb-3">
                                                                        <label for="id_topic_name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="id_topic_name" name="topic_name">
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary">Submit</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                



                                                




                                                

                                                <!-- Add MQTT Device Modal -->
                                                <div class="modal fade" id="addMqttDeviceModal" tabindex="-1" aria-labelledby="addMqttDeviceModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="addMqttDeviceModalLabel">Add Alarm Device</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="addMqttDeviceForm">
                                                                    {% csrf_token %}
                                                                    <div class="mb-3">
                                                                        <label for="device_name" class="form-label">Device Name</label>
                                                                        <input type="text" class="form-control" id="device_name" name="device_name" placeholder="Device Name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="ip_address" name="ip_address" placeholder="IP Address" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="topic_name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="topic_name" name="topic_name" placeholder="Topic Name" required>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary">Add Alarm Device</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Edit MQTT Device Modal -->
                                                <div class="modal fade" id="editMqttDeviceModal" tabindex="-1" aria-labelledby="editMqttDeviceModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editMqttDeviceModalLabel">Edit Alarm Device</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="editMqttDeviceForm">
                                                                    {% csrf_token %}
                                                                    <input type="hidden" id="edit_device_id" name="device_id">
                                                                    <div class="mb-3">
                                                                        <label for="edit_device_name" class="form-label">Device Name</label>
                                                                        <input type="text" class="form-control" id="edit_device_name" name="device_name" placeholder="Device Name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit_ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="edit_ip_address" name="ip_address" placeholder="IP Address" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit_topic_name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="edit_topic_name" name="topic_name" placeholder="Topic Name" required>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Delete MQTT Device Modal -->
                                                <div class="modal fade" id="deleteMqttDeviceModal" tabindex="-1" aria-labelledby="deleteMqttDeviceModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="deleteMqttDeviceModalLabel">Delete Alarm Device</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p>Are you sure you want to delete this device?</p>
                                                                <form id="deleteMqttDeviceForm">
                                                                    {% csrf_token %}
                                                                    <input type="hidden" id="delete_device_id" name="device_id">
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" class="btn btn-danger">Delete</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>



                                            

                                                <!-- Add GSM Module Modal -->
                                                <div class="modal fade" id="addGsmModuleModal" tabindex="-1" aria-labelledby="addGsmModuleModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="addGsmModuleModalLabel">Add GSM Module</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="addGsmModuleForm">
                                                                    {% csrf_token %}
                                                                    <div class="mb-3">
                                                                        <label for="module_name" class="form-label">Module Name</label>
                                                                        <input type="text" class="form-control" id="module_name" name="module_name" placeholder="Module Name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="gsm_ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="gsm_ip_address" name="ip_address" placeholder="IP Address" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="gsm_topic_name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="gsm_topic_name" name="topic_name" placeholder="Topic Name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="numbers" class="form-label">Numbers</label>
                                                                        <div id="numbers-container">
                                                                            <div class="input-group mb-2">
                                                                                <input type="text" class="form-control" name="numbers" placeholder="Comma-separated Numbers for making groups" required data-bs-toggle="tooltip">

                                                                                <button type="button" class="btn btn-success add-number">+</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="mb-3">
                                                                        <label for="mobile_username" class="form-label">Mobile Username</label>
                                                                        <input type="text" class="form-control" id="mobile_username" name="mobile_username" placeholder="Mobile Username" required>
                                                                    </div>
                                                                    



                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary">Add GSM Module</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                

                                                <!-- Edit GSM Module Modal -->
                                                <div class="modal fade" id="editGsmModuleModal" tabindex="-1" aria-labelledby="editGsmModuleModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editGsmModuleModalLabel">Edit GSM Module</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="editGsmModuleForm">
                                                                    {% csrf_token %}
                                                                    <input type="hidden" id="edit_module_id" name="module_id">
                                                                    <div class="mb-3">
                                                                        <label for="edit_module_name" class="form-label">Module Name</label>
                                                                        <input type="text" class="form-control" id="edit_module_name" name="module_name" placeholder="Module Name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit_gsm_ip_address" class="form-label">IP Address</label>
                                                                        <input type="text" class="form-control" id="edit_gsm_ip_address" name="ip_address" placeholder="IP Address" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit_gsm_topic_name" class="form-label">Topic Name</label>
                                                                        <input type="text" class="form-control" id="edit_gsm_topic_name" name="topic_name" placeholder="Topic Name" required>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="edit_numbers" class="form-label">Numbers</label>
                                                                        <input type="text" class="form-control" id="edit_numbers" name="numbers" placeholder="Comma-separated Numbers for making groups" required>
                                                                    </div>


                                                                    <div class="mb-3">
                                                                        <label for="edit_mobile_username" class="form-label">Mobile Username</label>
                                                                        <input type="text" class="form-control" id="edit_mobile_username" name="mobile_username" placeholder="Mobile Username" required>
                                                                    </div>
                                                                    



                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Delete GSM Module Modal -->
                                                <div class="modal fade" id="deleteGsmModuleModal" tabindex="-1" aria-labelledby="deleteGsmModuleModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="deleteGsmModuleModalLabel">Delete GSM Module</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p>Are you sure you want to delete this module?</p>
                                                                <form id="deleteGsmModuleForm">
                                                                    {% csrf_token %}
                                                                    <input type="hidden" id="delete_module_id" name="module_id">
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" class="btn btn-danger">Delete</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- View MQTT Device Modal -->
                                                <div class="modal fade" id="viewMqttDeviceModal" tabindex="-1" aria-labelledby="viewMqttDeviceModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="viewMqttDeviceModalLabel">MQTT Device Details</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p><strong>Device Name:</strong> <span id="view_device_name"></span></p>
                                                                <p><strong>IP Address:</strong> <span id="view_ip_address"></span></p>
                                                                <p><strong>Topic Name:</strong> <span id="view_topic_name"></span></p>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- View GSM Module Modal -->
                                                <div class="modal fade" id="viewGsmModuleModal" tabindex="-1" aria-labelledby="viewGsmModuleModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="viewGsmModuleModalLabel">GSM Module Details</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p><strong>Module Name:</strong> <span id="view_module_name"></span></p>
                                                                <p><strong>IP Address:</strong> <span id="view_gsm_ip_address"></span></p>
                                                                <p><strong>Topic Name:</strong> <span id="view_gsm_topic_name"></span></p>
                                                                <p><strong>Numbers:</strong> <span id="view_numbers"></span></p>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                
                                                <!-- Modal HTML -->
                                                <!-- Modal -->
                                                <div class="modal fade" id="assignBuildingsModal" tabindex="-1" aria-labelledby="assignBuildingsModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <form method="post" action="{% url 'assign-buildings' %}">
                                                                {% csrf_token %}
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="assignBuildingsModalLabel">Assign Rooms to Users</h5>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <input type="hidden" name="sub_admin_id" id="subAdminIdInput">
                                                                    <div class="form-group">
                                                                        <label for="buildings">Select Rooms:</label>
                                                                        <div id="building-checkboxes">
                                                                            {% for building in buildings %}
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" name="buildings[]" value="{{ building.id }}" id="building{{ building.id }}">
                                                                                    <label class="form-check-label" for="building{{ building.id }}">
                                                                                        {{ building.name }}
                                                                                    </label>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                

                                    </div>
                                </div>
                            </div>
                        </div>
                            
                    </div>
                </div>
            </div>
        </div>
    </div>                                                
    

                
                
                
                
                


                        

    <script>

        document.querySelectorAll('.mqtt-device-dropdown').forEach(dropdown => {
            dropdown.addEventListener('change', function() {
                const roomId = this.getAttribute('data-room-id');
                const selectedDeviceId = this.value;

                fetch('{% url "select_mqtt_device" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({
                        room_id: roomId,
                        mqtt_device_id: selectedDeviceId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('MQTT device updated successfully.');
                    } else {
                        alert('Failed to update MQTT device.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });



        document.addEventListener('DOMContentLoaded', function() {
            const updateInterval = 5000; // Update every 5 seconds

            function fetchPowerData() {
                fetch('/api/power-data/')  // Create an endpoint for fetching power data
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(powerData => {
                            document.querySelector(`#ct1-${powerData.power_module_id}`).textContent = powerData.ct1;
                            document.querySelector(`#ct2-${powerData.power_module_id}`).textContent = powerData.ct2;
                            document.querySelector(`#ct3-${powerData.power_module_id}`).textContent = powerData.ct3;
                            document.querySelector(`#ct4-${powerData.power_module_id}`).textContent = powerData.ct4;
                        });
                    });
            }

            fetchPowerData(); // Initial fetch
            setInterval(fetchPowerData, updateInterval); // Poll every interval
        });



        document.addEventListener('DOMContentLoaded', function () {
            // View button handler
            document.querySelectorAll('.view-button').forEach(button => {
                button.addEventListener('click', function () {
                    const powerModuleId = this.dataset.id;
                    fetch(`/view-power-module/${powerModuleId}/`)
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById('view-id').textContent = data.id;
                            document.getElementById('view-name').textContent = data.name;
                            document.getElementById('view-ip-address').textContent = data.ip_address;
                            document.getElementById('view-topic-name').textContent = data.topic_name;
                            // Fetch and populate CT data if needed
                            fetchPowerData(powerModuleId);
                        });
                });
            });

            // Edit button handler
            // document.querySelectorAll('.edit-button').forEach(button => {
            //     button.addEventListener('click', function () {
            //         const powerModuleId = this.dataset.id;
            //         fetch(`/view-power-module/${powerModuleId}/`)
            //             .then(response => response.json())
            //             .then(data => {
            //                 document.getElementById('edit-id').value = data.id;
            //                 document.getElementById('edit-name').value = data.name;
            //                 document.getElementById('edit-ip-address').value = data.ip_address;
            //                 document.getElementById('edit-topic-name').value = data.topic_name;
            //             });
            //     });
            // });




            // document.querySelectorAll('.edit-button').forEach(button => {
            //     button.addEventListener('click', function () {
            //         const powerModuleId = this.dataset.id;
            //         fetch(`/view-power-module/${powerModuleId}/`)
            //             .then(response => response.json())
            //             .then(data => {
            //                 document.getElementById('edit-id').value = data.id;
            //                 document.getElementById('edit-name').value = data.name;
            //                 document.getElementById('edit-ip-address').value = data.ip_address;
            //                 document.getElementById('edit-topic-name').value = data.topic_name;

            //                 // Set the buildings checkboxes based on the fetched data
            //                 const buildingIds = data.buildings; // Assuming this returns an array of building IDs
            //                 document.querySelectorAll('#edit-buildings .form-check-input').forEach(checkbox => {
            //                     checkbox.checked = buildingIds.includes(parseInt(checkbox.value));
            //                 });
            //             });
            //     });
            // });


            document.querySelectorAll('.edit-button').forEach(button => {
                button.addEventListener('click', function () {
                    const powerModuleId = this.dataset.id;
                    fetch(`/view-power-module/${powerModuleId}/`)
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById('edit-id').value = data.id;
                            document.getElementById('edit-name').value = data.name;
                            document.getElementById('edit-ip-address').value = data.ip_address;
                            document.getElementById('edit-topic-name').value = data.topic_name;
                            document.getElementById('edit-ct1-name').value = data.ct1correspondingname;
                            document.getElementById('edit-ct2-name').value = data.ct2correspondingname;
                            document.getElementById('edit-ct3-name').value = data.ct3correspondingname;
                            document.getElementById('edit-ct4-name').value = data.ct4correspondingname;

                            // Set the buildings checkboxes based on the fetched data
                            const buildingIds = data.buildings; // Assuming this returns an array of building IDs
                            document.querySelectorAll('#edit-buildings .form-check-input').forEach(checkbox => {
                                checkbox.checked = buildingIds.includes(parseInt(checkbox.value));
                            });
                        });
                });
            });



            // Handle form submission for editing
            document.getElementById('edit-power-form').addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                fetch('/edit-power-module/', {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload(); // Reload the page on success
                        } else {
                            alert('Failed to edit Power Module');
                        }
                    });
            });

            // Delete button handler
            document.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', function () {
                    const powerModuleId = this.dataset.id;
                    document.getElementById('delete-id').value = powerModuleId;
                });
            });

            // Handle form submission for deleting
            document.getElementById('delete-power-form').addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                fetch('/delete-power-module/', {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload(); // Reload the page on success
                        } else {
                            alert('Failed to delete Power Module');
                        }
                    });
            });
        });

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



///////////////////////////////////////////////////////////    code for staying it  the tab after refresh 
        document.addEventListener("DOMContentLoaded", function () {
            // Check if there's a stored tab in the local storage
            const storedTab = localStorage.getItem('activeTab');
            if (storedTab) {
                // If there's a stored tab, trigger the click event to open it
                const tabToShow = document.querySelector(`a[href="${storedTab}"]`);
                if (tabToShow) {
                    new bootstrap.Tab(tabToShow).show();
                }
            }

            // Add a click event listener to all tabs
            const tabElements = document.querySelectorAll('.list-group-item');
            tabElements.forEach(tabElement => {
                tabElement.addEventListener('click', function () {
                    // Store the tab href in local storage
                    localStorage.setItem('activeTab', this.getAttribute('href'));
                });
            });
        });
/////////////////////////////////////////////////////////



        function filterRooms() {
            const filter = document.getElementById('filter').value;
            window.location.href = `?filter=${filter}`;
        }


        document.addEventListener('DOMContentLoaded', (event) => {
            var editThresholdModal = document.getElementById('editThresholdModal');
            editThresholdModal.addEventListener('show.bs.modal', function (event) {
                var button = event.relatedTarget;
                var roomId = button.getAttribute('data-id');
                var thresholdType = button.getAttribute('data-type');
                var thresholdValue = button.getAttribute('data-value');

                var modal = this;
                modal.querySelector('#roomId').value = roomId;
                modal.querySelector('#thresholdType').value = thresholdType;
                modal.querySelector('#thresholdValue').value = thresholdValue;
            });
        });

        






        



        document.addEventListener("DOMContentLoaded", function() {
            // Attach submit event to each edit form
            document.querySelectorAll("[id^=editRoomForm]").forEach(form => {
                form.addEventListener("submit", function(event) {
                    event.preventDefault();
                    const form = event.target;
                    const data = new FormData(form);
                    const roomId = form.id.replace("editRoomForm", "");

                    // Clear previous error messages
                    form.querySelectorAll(".error-message").forEach(error => error.remove());

                    // Validation: Check if any input field is empty
                    let isValid = true;
                    form.querySelectorAll("input").forEach(input => {
                        if (input.value.trim() === "") {
                            isValid = false;

                            // Create an error message element
                            const errorMessage = document.createElement("div");
                            errorMessage.className = "error-message text-danger";
                            errorMessage.textContent = "This field is required.";

                            // Insert the error message just above the empty input field
                            input.parentNode.insertBefore(errorMessage, input);

                            input.classList.add("is-invalid"); // Optionally, add a class to highlight the invalid field
                        } else {
                            input.classList.remove("is-invalid");
                        }
                    });

                    if (!isValid) {
                        // Stop the form submission if validation fails
                        return;
                    }

                    fetch(form.action, {
                        method: "POST",
                        body: data,
                        headers: {
                            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Close modal
                            const modal = document.getElementById(`editRoomModal${roomId}`);
                            const modalInstance = bootstrap.Modal.getInstance(modal);
                            modalInstance.hide();

                            // Update the table row with the edited room data
                            const row = document.querySelector(`tr[data-room-id="${roomId}"]`);
                            row.querySelector("td[data-field='name']").textContent = data.room.name;
                            row.querySelector("td[data-field='ip_address']").textContent = data.room.ip_address;
                            row.querySelector("td[data-field='topic_name']").textContent = data.room.topic_name;
                        } else {
                            // Handle errors
                            alert("Error editing room");
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
                });
            });
        });



        document.addEventListener("DOMContentLoaded", function() {
            // Attach submit event to each delete form
            document.querySelectorAll("[id^=deleteRoomForm]").forEach(form => {
                form.addEventListener("submit", function(event) {
                    event.preventDefault();
                    const form = event.target;
                    const data = new FormData(form);
                    const roomId = form.id.replace("deleteRoomForm", "");

                    fetch(form.action, {
                        method: "POST",
                        body: data,
                        headers: {
                            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Close modal
                            const modal = document.getElementById(`deleteRoomModal${roomId}`);
                            const modalInstance = bootstrap.Modal.getInstance(modal);
                            modalInstance.hide();

                            // Remove the table row
                            const row = document.querySelector(`tr[data-room-id="${roomId}"]`);
                            row.remove();
                        } else {
                            // Handle errors
                            alert("Error deleting room");
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
                });
            });
        });

        document.addEventListener("DOMContentLoaded", function() {
            const addRoomForm = document.getElementById("addRoomForm");

            // Handle form submission
            addRoomForm.addEventListener("submit", function(event) {
                event.preventDefault();
                const form = event.target;
                const data = new FormData(form);

                fetch(form.action, {
                    method: "POST",
                    body: data,
                    headers: {
                        "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Close modal
                        const modal = document.getElementById("addRoomModal");
                        const modalInstance = bootstrap.Modal.getInstance(modal);
                        modalInstance.hide();

                        // Append new room to the table
                        const tableBody = document.querySelector(".datatables-basic tbody");
                        const newRow = document.createElement("tr");
                        newRow.setAttribute("data-room-id", data.room.id);
                        newRow.innerHTML = `
                            <td>${data.room.id}</td>
                            <td data-field="name">${data.room.name}</td>
                            <td data-field="ip_address">${data.room.ip_address}</td>
                            <td data-field="topic_name">${data.room.topic_name}</td>
                            <td>
                                <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#viewRoomModal${data.room.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editRoomModal${data.room.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteRoomModal${data.room.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        `;
                        tableBody.appendChild(newRow);

                        // Optionally reset the form
                        form.reset();

                        // Refresh the page
                        window.location.reload();
                    } else {
                        // Handle errors
                        alert("Error adding room");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
            });

            // Clear the form when the modal is hidden
            const addRoomModal = document.getElementById("addRoomModal");
            addRoomModal.addEventListener("hide.bs.modal", function() {
                addRoomForm.reset();
            });
        });




           
////////////////////////////////////////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

        


        document.addEventListener("DOMContentLoaded", function() {
            const addBuildingForm = document.getElementById("addBuildingForm");
            if (addBuildingForm) {
                addBuildingForm.addEventListener("submit", function(event) {
                    event.preventDefault();
                    const data = new FormData(addBuildingForm);

                    fetch(addBuildingForm.action, {
                        method: "POST",
                        body: data,
                        headers: {
                            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Optionally append new building to the table
                            const tbody = document.querySelector(".datatables-basic tbody");
                            const newRow = `<tr data-building-id="${data.building.id}">
                                <td>${data.building.id}</td>
                                <td>${data.building.name}</td>
                                <td>${data.building.rooms.join(", ")}</td>
                                <td>
                                    <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editBuildingModal${data.building.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteBuildingModal${data.building.id}">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>`;
                            tbody.insertAdjacentHTML('beforeend', newRow);
                            
                            // Close modal
                            const modal = bootstrap.Modal.getInstance(document.getElementById('addBuildingModal'));
                            modal.hide();
                            
                            // Refresh the page
                            window.location.reload();
                        } else {
                            alert("Error adding building");
                        }
                    })
                    .catch(error => console.error("Error:", error));
                });
            }
        });



        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll("[id^=editBuildingForm]").forEach(form => {
                form.addEventListener("submit", function(event) {
                    event.preventDefault();
                    const data = new FormData(form);
                    const buildingId = form.id.replace("editBuildingForm", "");

                    fetch(form.action, {
                        method: "POST",
                        body: data,
                        headers: {
                            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const row = document.querySelector(`tr[data-building-id="${buildingId}"]`);
                            row.querySelector("td:nth-child(2)").textContent = data.building.name;
                            row.querySelector("td:nth-child(3)").innerHTML = data.building.rooms.join("<br>");
                            // Close modal
                            const modal = bootstrap.Modal.getInstance(document.getElementById(`editBuildingModal${buildingId}`));
                            modal.hide();
                            // Refresh the page
                            window.location.reload();
                        } else {
                            alert("Error editing building");
                        }
                    })
                    .catch(error => console.error("Error:", error));
                });
            });

            // Clear form data when modal is hidden
            document.querySelectorAll(".modal").forEach(modal => {
                modal.addEventListener('hidden.bs.modal', function () {
                    const form = modal.querySelector("form");
                    if (form) {
                        form.reset(); // Clear form fields
                    }
                });
            });
        });


        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll("[id^=deleteBuildingForm]").forEach(form => {
                form.addEventListener("submit", function(event) {
                    event.preventDefault();
                    const data = new FormData(form);
                    const buildingId = form.id.replace("deleteBuildingForm", "");

                    fetch(form.action, {
                        method: "POST",
                        body: data,
                        headers: {
                            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const row = document.querySelector(`tr[data-building-id="${buildingId}"]`);
                            row.remove();
                            // Close modal
                            const modal = bootstrap.Modal.getInstance(document.getElementById(`deleteBuildingModal${buildingId}`));
                            modal.hide();
                        } else {
                            alert("Error deleting building");
                        }
                    })
                    .catch(error => console.error("Error:", error));
                });
            });
        });


////////////////////////////////////////////
        



        document.addEventListener("DOMContentLoaded", function() {
            const assignBuildingsModal = document.getElementById('assignBuildingsModal');

            // Show modal and set sub-admin ID
            assignBuildingsModal.addEventListener('show.bs.modal', function(event) {
                const button = event.relatedTarget;
                const subAdminId = button.getAttribute('data-subadmin-id');
                document.getElementById('subAdminIdInput').value = subAdminId;

                // Pre-select assigned buildings
                const buildingsList = document.querySelector(`tr[data-sub-admin-id="${subAdminId}"] .buildings-list`).textContent.split(', ').map(b => b.trim());
                document.querySelectorAll('#building-checkboxes input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = buildingsList.includes(checkbox.nextElementSibling.textContent.trim());
                });
            });

            // Handle form submission
            document.querySelector('form[action="{% url 'assign-buildings' %}"]').addEventListener('submit', function(event) {
                event.preventDefault();
                const form = event.target;
                const data = new FormData(form);

                fetch(form.action, {
                    method: "POST",
                    body: data,
                    headers: {
                        "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Close modal
                        const modalInstance = bootstrap.Modal.getInstance(assignBuildingsModal);
                        modalInstance.hide();

                        // Update buildings list in the table
                        const updatedBuildings = data.buildings.map(b => b.name).join(", ");
                        const row = document.querySelector(`tr[data-sub-admin-id="${data.sub_admin_id}"] .buildings-list`);
                        row.textContent = updatedBuildings;
                    } else {
                        alert("Error assigning buildings");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
            });
        });

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        

        



            


     

 

        document.addEventListener('DOMContentLoaded', function() {
            const editBtns = document.querySelectorAll('.edit-btn');
            editBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const roomId = this.dataset.id;
                    const type = this.dataset.type;
                    const value = this.dataset.value;
                    document.getElementById('roomId').value = roomId;
                    document.getElementById('thresholdType').value = type;
                    document.getElementById('thresholdValue').value = value;
                });
            });

            const editForm = document.getElementById('editThresholdForm');
            editForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(this);
                fetch("{% url 'edit_threshold' %}", {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Failed to update threshold');
                    }
                });
            });

            const sensorSwitches = document.querySelectorAll('.sensor-switch');
            sensorSwitches.forEach(switchElement => {
                switchElement.addEventListener('change', function() {
                    const roomId = this.dataset.id;
                    const type = this.dataset.type;
                    const value = this.checked ? 'enabled' : 'disabled';
                    fetch("{% url 'toggle_sensor' %}", {
                        method: 'POST',
                        body: JSON.stringify({ room_id: roomId, type: type, value: value }),
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (!data.success) {
                            alert('Failed to update sensor state');
                        }
                    });
                });
            });

            const alertDropdowns = document.querySelectorAll('.color-alert-dropdown');
            alertDropdowns.forEach(dropdown => {
                dropdown.addEventListener('change', function() {
                    const roomId = this.dataset.id;
                    const type = this.dataset.type;
                    const value = this.value;
                    fetch("{% url 'update_alert' %}", {
                        method: 'POST',
                        body: JSON.stringify({ room_id: roomId, type: type, value: value }),
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (!data.success) {
                            alert('Failed to update alert configuration');
                        }
                    });
                });
            });
        });

        

      ///////////////////////////////////////////////  //////////////////////////////////////////////////////////////////////////////////////




   

        document.addEventListener('DOMContentLoaded', function () {
            // Function to validate IP address format
            function validateIpAddress(ip) {
                const ipPattern = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
                return ipPattern.test(ip);
            }

            // Function to check if all fields are filled
            function checkRequiredFields(form) {
                const inputs = form.querySelectorAll('input[required]');
                for (let input of inputs) {
                    if (input.value.trim() === '') {
                        return false;
                    }
                }
                return true;
            }

            // Handle form submission for adding MQTT Device
            document.getElementById('addMqttDeviceForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                const ipAddress = formData.get('ip_address');
                
                // Check if fields are filled and IP address is valid
                if (!checkRequiredFields(this)) {
                    alert('Please fill out all required fields.');
                    return;
                }

                if (!validateIpAddress(ipAddress)) {
                    alert('Please enter a valid IP address.');
                    return;
                }

                fetch('/add-mqtt-device/', {
                    method: 'POST',
                    body: JSON.stringify(Object.fromEntries(formData)),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                    }
                }).then(response => response.json()).then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert(data.error);
                    }
                });
            });

            // Handle form submission for editing MQTT Device
            document.getElementById('editMqttDeviceForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                const ipAddress = formData.get('ip_address');
                
                // Check if fields are filled and IP address is valid
                if (!checkRequiredFields(this)) {
                    alert('Please fill out all required fields.');
                    return;
                }

                if (!validateIpAddress(ipAddress)) {
                    alert('Please enter a valid IP address.');
                    return;
                }

                fetch(`/edit-mqtt-device/${formData.get('device_id')}/`, {
                    method: 'POST',
                    body: JSON.stringify(Object.fromEntries(formData)),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                    }
                }).then(response => response.json()).then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert(data.error);
                    }
                });
            });



    

            // Handle form submission for deleting MQTT Device
            document.getElementById('deleteMqttDeviceForm').addEventListener('submit', function (e) {
                e.preventDefault();
                let formData = new FormData(this);
                fetch('/delete-mqtt-device/', {
                    method: 'DELETE',
                    body: JSON.stringify(Object.fromEntries(formData)),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                    }
                }).then(response => response.json()).then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert(data.error);
                    }
                });
            });

            // Populate Edit and Delete modals with data
            document.querySelectorAll('button[data-bs-toggle="modal"]').forEach(button => {
                button.addEventListener('click', function () {
                    let modalId = button.getAttribute('data-bs-target');
                    let deviceId = button.getAttribute('data-id');
                    if (modalId === '#editMqttDeviceModal' || modalId === '#deleteMqttDeviceModal') {
                        fetch(`/get-mqtt-device/${deviceId}/`)
                            .then(response => response.json())
                            .then(data => {
                                if (modalId === '#editMqttDeviceModal') {
                                    document.getElementById('edit_device_id').value = data.id;
                                    document.getElementById('edit_device_name').value = data.name;
                                    document.getElementById('edit_ip_address').value = data.ip_address;
                                    document.getElementById('edit_topic_name').value = data.topic_name;
                                } else if (modalId === '#deleteMqttDeviceModal') {
                                    document.getElementById('delete_device_id').value = data.id;
                                }
                            });
                    }
                });
            });



            

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            
        document.addEventListener('DOMContentLoaded', function () {
                // Initialize tooltips
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl)
                })
            });

            // Add event listener to show tooltip
            document.querySelectorAll('input[name="numbers"]').forEach(input => {
                input.addEventListener('focus', function () {
                    var tooltip = new bootstrap.Tooltip(this, {
                        title: 'Please enter the number with country code +91',
                        placement: 'top'
                    });
                    tooltip.show();
                });
            });

            document.querySelector('.add-number').addEventListener('click', function () {
                const numbersContainer = document.getElementById('numbers-container');
                const newInput = document.createElement('div');
                newInput.classList.add('input-group', 'mb-2');
                newInput.innerHTML = `
                    <input type="text" class="form-control" name="numbers" placeholder="Numbers Enter for single entry" required>
                    <button type="button" class="btn btn-danger remove-number">-</button>
                `;
                numbersContainer.appendChild(newInput);

                newInput.querySelector('.remove-number').addEventListener('click', function () {
                    numbersContainer.removeChild(newInput);
                });
            });

//////////////////////////////////////////////
/////////////////////////////////////////////

            // document.getElementById('addGsmModuleForm').addEventListener('submit', function (e) {
            //     e.preventDefault();
            //     let formData = new FormData(this);
            //     let numbers = [];
            //     formData.getAll('numbers').forEach(number => {
            //         numbers.push(number);
            //     });
            //     formData.set('numbers', JSON.stringify(numbers));

            //     fetch('/add-gsm-module/', {
            //         method: 'POST',
            //         body: JSON.stringify(Object.fromEntries(formData)),
            //         headers: {
            //             'Content-Type': 'application/json',
            //             'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            //         }
            //     }).then(response => response.json()).then(data => {
            //         if (data.success) {
            //             location.reload();
            //         } else {
            //             alert(data.error);
            //         }
            //     });
            // });

            // document.getElementById('editGsmModuleForm').addEventListener('submit', function (e) {
            //     e.preventDefault();
                
            //     let formData = new FormData(this);
            //     let numbers = formData.getAll('numbers'); // Get all numbers directly from form input

            //     let data = {
            //         module_id: formData.get('module_id'),
            //         module_name: formData.get('module_name'),
            //         ip_address: formData.get('ip_address'),
            //         topic_name: formData.get('topic_name'),
            //         numbers: JSON.stringify(numbers)  // Send as JSON string
            //     };

            //     fetch(`/edit-gsm-module/${data.module_id}/`, {
            //         method: 'POST',
            //         body: JSON.stringify(data),
            //         headers: {
            //             'Content-Type': 'application/json',
            //             'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            //         }
            //     }).then(response => response.json()).then(data => {
            //         if (data.success) {
            //             location.reload();  // Refresh the page after successful editing
            //         } else {
            //             alert(data.error);
            //         }
            //     });
            // });


            document.getElementById('addGsmModuleForm').addEventListener('submit', function (e) {
                e.preventDefault();
                let formData = new FormData(this);
                let numbers = [];
                formData.getAll('numbers').forEach(number => numbers.push(number));

                let data = {
                    module_name: formData.get('module_name'),
                    ip_address: formData.get('ip_address'),
                    topic_name: formData.get('topic_name'),
                    numbers: JSON.stringify(numbers),
                    mobile_username: formData.get('mobile_username') // Include mobile username
                };

                fetch('/add-gsm-module/', {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                    }
                }).then(response => response.json()).then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert(data.error);
                    }
                });
            });

            document.getElementById('editGsmModuleForm').addEventListener('submit', function (e) {
                e.preventDefault();
                let formData = new FormData(this);
                let numbers = formData.getAll('numbers');

                let data = {
                    module_id: formData.get('module_id'),
                    module_name: formData.get('module_name'),
                    ip_address: formData.get('ip_address'),
                    topic_name: formData.get('topic_name'),
                    numbers: JSON.stringify(numbers),
                    mobile_username: formData.get('mobile_username') // Include mobile username
                };

                fetch(`/edit-gsm-module/${data.module_id}/`, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                    }
                }).then(response => response.json()).then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert(data.error);
                    }
                });
            });





            // Delete GSM Module
            document.getElementById('deleteGsmModuleForm').addEventListener('submit', function (e) {
                e.preventDefault();
                let formData = new FormData(this);
                fetch('/delete-gsm-module/', {
                    method: 'DELETE',
                    body: JSON.stringify(Object.fromEntries(formData)),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                    }
                }).then(response => response.json()).then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert(data.error);
                    }
                });
            });

            // Populate Edit and Delete modals with data for GSM modules
            document.querySelectorAll('button[data-bs-toggle="modal"]').forEach(button => {
                button.addEventListener('click', function () {
                    let modalId = button.getAttribute('data-bs-target');
                    let moduleId = button.getAttribute('data-id');
                    if (modalId === '#editGsmModuleModal' || modalId === '#deleteGsmModuleModal') {
                        fetch(`/get-gsm-module/${moduleId}/`)
                            .then(response => response.json())
                            .then(data => {
                                if (modalId === '#editGsmModuleModal') {
                                    document.getElementById('edit_module_id').value = data.id;
                                    document.getElementById('edit_module_name').value = data.module_name;
                                    document.getElementById('edit_gsm_ip_address').value = data.ip_address;
                                    document.getElementById('edit_gsm_topic_name').value = data.topic_name;
                                    document.getElementById('edit_numbers').value = data.numbers.join(',');
                                } else if (modalId === '#deleteGsmModuleModal') {
                                    document.getElementById('delete_module_id').value = data.id;
                                }
                            });
                    }
                });
            });
        });

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.list-group-item');
            tabs.forEach(tab => {
                tab.addEventListener('click', function (event) {
                    event.preventDefault();
                    const tabContentId = this.getAttribute('href').replace('#', '');
                    const tabContent = document.getElementById(tabContentId);

                    if (tabContent) {
                        const activeTab = document.querySelector('.list-group-item.active');
                        const activeTabContent = document.querySelector('.tab-pane.show.active');

                        if (activeTab && activeTabContent) {
                            activeTab.classList.remove('active');
                            activeTabContent.classList.remove('show', 'active');
                        }

                        this.classList.add('active');
                        tabContent.classList.add('show', 'active');
                    }
                });
            });
        });


        document.addEventListener('DOMContentLoaded', function() {
            // Handle GSM Sensor toggle
            document.querySelectorAll('.gsm-switch').forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    const roomId = this.dataset.id;
                    const isChecked = this.checked;
                    const dropdown = document.querySelector(`.gsm-number-dropdown[data-id="${roomId}"]`);
                    dropdown.style.display = isChecked ? 'block' : 'none';

                    const data = {
                        room_id: roomId,
                        type: 'gsm_alert',
                        value: isChecked ? 'enabled' : 'disabled'
                    };

                    fetch('/toggle_sensor/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(data)
                    }).then(response => response.json()).then(data => {
                        if (data.success) {
                            console.log('GSM Sensor toggled successfully');
                        } else {
                            console.error('Failed to toggle GSM Sensor');
                        }
                    });
                });
            });

            // Handle GSM Number selection
            document.querySelectorAll('.gsm-number-dropdown').forEach(function(dropdown) {
                dropdown.addEventListener('change', function() {
                    const roomId = this.dataset.id;
                    const selectedNumber = this.value;

                    const data = new FormData();
                    data.append('romid', roomId);
                    data.append('gsmalert', 'enabled');
                    data.append('gsmnumbers', selectedNumber);

                    fetch('/gsmFormsubmit/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: data
                    }).then(response => response.json()).then(data => {
                        if (data.message === 'GSM Nmuber set successfully') {
                            console.log('GSM Number set successfully');
                        } else {
                            console.error('Failed to set GSM Number');
                        }
                    });
                });
            });

            // Handle Time Interval input
            document.querySelectorAll('.interval-input').forEach(function(input) {
                input.addEventListener('change', function() {
                    const roomId = this.dataset.id;
                    const timePeriod = this.value;

                    const data = new FormData();
                    data.append('romid', roomId);
                    data.append('timePeriod', timePeriod);

                    fetch('/intervalFormsubmit/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: data
                    }).then(response => response.json()).then(data => {
                        if (data.message === 'Interval set successfully') {
                            console.log('Interval set successfully');
                        } else {
                            console.error('Failed to set interval');
                        }
                    });
                });
            });
        });


        document.addEventListener('DOMContentLoaded', function () {
            const gsmSwitches = document.querySelectorAll('.gsm-switch');
            gsmSwitches.forEach(gsmSwitch => {
                gsmSwitch.addEventListener('change', function () {
                    const id = this.getAttribute('data-id');
                    const dropdown = document.querySelector(`.gsm-number-dropdown[data-id='${id}']`);
                    if (this.checked) {
                        dropdown.style.display = 'block';
                    } else {
                        dropdown.style.display = 'none';
                    }
                });
            });
        });


//////////////////////////////////////////////////////////////   cluster



        


        
        
        
        

        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("addClusterForm").addEventListener("submit", function(event) {
                event.preventDefault();
                const form = event.target;
                const data = new FormData(form);

                fetch(form.action, {
                    method: "POST",
                    body: data,
                    headers: {
                        "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Close modal
                        const modal = document.getElementById('addClusterModal');
                        const modalInstance = bootstrap.Modal.getInstance(modal);
                        modalInstance.hide();

                        // Update the table with the new cluster data
                        const newClusterRow = document.createElement('tr');
                        newClusterRow.innerHTML = `
                            <td>${data.cluster.id}</td>
                            <td>${data.cluster.name}</td>
                            <td>${data.cluster.description}</td>
                            <td>
                                <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#viewClusterModal${data.cluster.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#editClusterModal${data.cluster.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#deleteClusterModal${data.cluster.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        `;
                        document.querySelector('.datatables-basic tbody').appendChild(newClusterRow);

                        // Optionally reset the form
                        form.reset();

                        // Refresh the page
                        window.location.reload();
                    } else {
                        // Handle errors
                        alert("Error adding cluster");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
            });
        });

        



        
        document.addEventListener("DOMContentLoaded", function() {
            // Attach submit event to each edit form
            document.querySelectorAll("[id^=editClusterForm]").forEach(form => {
                form.addEventListener("submit", function(event) {
                    event.preventDefault();
                    const form = event.target;
                    const data = new FormData(form);
                    const clusterId = form.id.replace("editClusterForm", "");

                    fetch(form.action, {
                        method: "POST",
                        body: data,
                        headers: {
                            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Close modal
                            const modal = document.getElementById(`editClusterModal${clusterId}`);
                            const modalInstance = bootstrap.Modal.getInstance(modal);
                            modalInstance.hide();

                            // Update the table row with the edited cluster data
                            const row = document.querySelector(`tr[data-cluster-id="${clusterId}"]`);
                            row.querySelector("td[data-field='name']").textContent = data.cluster.name;
                            row.querySelector("td[data-field='description']").textContent = data.cluster.description;
                        } else {
                            // Handle errors
                            console.error("Error editing cluster", data.errors);
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
                });
            });
        });


        document.addEventListener("DOMContentLoaded", function() {
            // Attach submit event to each delete form
            document.querySelectorAll("[id^=deleteClusterForm]").forEach(form => {
                form.addEventListener("submit", function(event) {
                    event.preventDefault();
                    const form = event.target;
                    const data = new FormData(form);
                    const clusterId = form.id.replace("deleteClusterForm", "");

                    fetch(form.action, {
                        method: "POST",
                        body: data,
                        headers: {
                            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Close modal
                            const modal = document.getElementById(`deleteClusterModal${clusterId}`);
                            const modalInstance = bootstrap.Modal.getInstance(modal);
                            modalInstance.hide();

                            // Remove the table row
                            const row = document.querySelector(`tr[data-cluster-id="${clusterId}"]`);
                            row.remove();
                        } else {
                            // Handle errors
                            alert("Error deleting cluster");
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
                });
            });
        });


        
                

        
///////////////////////////////////////////////

    </script>



{% endblock %}