{% extends 'base.html' %}

{% load static %}
{% get_static_prefix as static %}

{% block content %}



<div class="container-fluid flex-grow-1 container-p-y">
    <div class="alert alert-success d-none" role="alert">Alert details saved successfully </div>
    <div class="alert alert-success d-none" role="alert">Alert details updated successfully </div>
    <h4 class="py-0 mb-3"> Alerts</h4>

    <div class="row">
      <div class="col-md-12">
          <div class="nav-align-top nav-tabs-shadow mb-4">
            <div class="tab-content">
              <div class="tab-pane fade show active" id="navs-top-home" role="tabpanel">
                  <div class="tabcamz">
                      <div class="row">
                        <div class="col-sm-6 col-lg-3 mb-4">
                          <div class="card card-border-shadow-primary shtboxz">
                            <div class="card-body p-3">
                              <h5 class="mb-2">Total Alerts</h5>
                              <div class="d-flex justify-content-between align-items-center mb-0">
                                <div class="lefend"> 
                                  <h4 class="mb-0" id="total">{{total}}</h4>
                                </div> 
                                <div class="jusend">
                                  <button type="button" class="btn btn-label-primary waves-effect">All</button>
                                </div> 
                              </div>  
                            </div>
                          </div>
                        </div>

                        <div class="col-sm-6 col-lg-3 mb-4">
                          <div class="card card-border-shadow-warning shtboxz">
                            <div class="card-body p-3">
                              <h5 class="mb-2">Active Alerts</h5>
                              <div class="d-flex justify-content-between align-items-center mb-0">
                                <div class="lefend"> 
                                  <h4 class="mb-0" id="active">{{active}}</h4>
                                </div> 
                                <div class="jusend">
                                  <button type="button" class="btn btn-label-warning waves-effect">Active</button>
                                </div> 
                              </div>  
                            </div>
                          </div>
                        </div>

                        <div class="col-sm-6 col-lg-3 mb-4">
                          <div class="card card-border-shadow-danger shtboxz">
                            <div class="card-body p-3">
                              <h5 class="mb-2">Inactive Alerts</h5>
                              <div class="d-flex justify-content-between align-items-center mb-0">
                                <div class="lefend"> 
                                  <h4 class="mb-0" id="inactive">{{inactive}}</h4>
                                </div> 
                                <div class="jusend">
                                  <button type="button" class="btn btn-label-danger waves-effect">Inactive</button>
                                </div> 
                              </div>  
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-6 col-lg-3 mb-4">
                          <div class="card card-border-shadow-danger shtboxz">
                            <div class="card-body p-3">
                              <h5 class="mb-2">Pending Alerts</h5>
                              <div class="d-flex justify-content-between align-items-center mb-0">
                                <div class="lefend"> 
                                  <h4 class="mb-0" id="pending">{{pending}}</h4>
                                </div> 
                                <div class="jusend">
                                  <button type="button" class="btn btn-label-danger waves-effect">Pending</button>
                                </div> 
                              </div>  
                            </div>
                          </div>
                        </div>




                        
                        <div class="com-md-12">
                            


                          <!-- DataTable with Buttons -->
                          <div class="card mt-3">

                            <div class="card-header mt-0 mb-0 pt-3 pb-0 filtlinez">

                              <div class="d-flex justify-content-between align-items-center ">
                                <div class="headlizt pt-0">
                                <h5>Alert Details</h5>
                                </div>
                                
                                                                    

                              </div>

                              <div class="fillshow">
                                <div class="collapse mb-3" id="collapseFilter" style="display:block">
                                  <form class="dt_adv_search" method="GET">
                                    <div class="row">
                                      <div class="col-12">
                                        <div class="row g-3">
                                          <div class="col-12 col-sm-6 col-lg-3"> 
                                            <div class="ecommerce-select2-dropdown">
                                              <label class="form-label" for="ecommerce-category-parent-category">Camera</label>
                                              <select
                                                id="camera"
                                                class="select2 form-select"
                                                data-placeholder="Select parent category">
                                                <option value="0">Select Camera </option>
                                                {% for cam in camera %}
                                        <option value="{{cam.cam_id}}">{{cam.cam_name}}</option>
                                                {% endfor %}
                                              </select>
                                            </div>
                                          </div>
                                          <div class="col-12 col-sm-6 col-lg-3"> 
                                            <div class="ecommerce-select2-dropdown">
                                              <label class="form-label" for="ecommerce-category-parent-category">Date</label>
                                              <input type="text" class="form-control" placeholder="YYYY-MM-DD to YYYY-MM-DD" id="flatpickr-range" />        
                                       <!-- <select
                                                id="ecommerce-category-parent-category"
                                                class="select2 form-select"
                                                data-placeholder="Select parent category">
                                                <option value="">Priority 1 </option>
                                                <option value=" ">1</option>
                                                <option value=" ">2</option>
                                                <option value=" ">3</option>
                                                <option value=" ">4</option>
                                                <option value=" ">5</option>
                                              </select> -->
                                            </div>
                                          </div>  
                                          <div class="col-12 col-sm-6 col-lg-3"> 
                                            <div class="ecommerce-select2-dropdown">
                                              <label class="form-label" for="ecommerce-category-parent-category">Use Case</label>
                                              <select
                                                id="algorithm"
                                                class="select2 form-select"
                                                data-placeholder="Select parent category">
                                                <option value="">Select Algorithm </option>
                                                  {% for algo in algorithm %}
                                             <option value="{{algo.algo_name}}" > {{algo.algo_name}} </option>
                                                {% endfor %}
                                               
                                              </select>
                                            </div>
                                          </div>  
                                          <div class="col-12 col-sm-6 col-lg-3"> 
                                            <div class="sercanbox">
                                              <button type="button" class="btn btn-primary me-sm-3 me-1 waves-effect waves-light" onclick="searchalert()">Search</button>  
                                            <button type="reset" class="btn btn-outline-secondary waves-effect" onclick="refresh()">Refresh</button>   
                                            </div>                                                       
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </form>
                                </div> 
                              </div>
                          </div>

                            <div class="card-datatable table-responsive pt-0">
                              <table class="datatables-basic table conftable" id="alerttable">
                                <thead>
                                  <tr> 
                                    <th>Priority</th>
                                    <th>Alert Title</th>
                                    <th>Cameras</th> 
                                    <th>Alert Date</th>
                                    <th>Alert Time</th>
                                    <th>Assigned To</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                  </tr>
                                </thead>

                                <tbody class="table-border-bottom-0"  id="alerttabletbody"> 

                                    {% for algo in alertdataapi %}

                                    <tr>
                                      <td>{{algo.priority}}</td>
                                      <td>{{algo.alert_title}}</td>
                                      <td>{{algo.camera}}</td>
                                      <td>{{algo.alert_date}}</td>
                                      <td>{{algo.alert_time}}</td>
                                      <td>{{request.user.username}}</td>

                                    {% if algo.alert_read_status == 0 %}
                                  <td><span class="badge bg-label-success me-1">Active</span></td>
                                  {% elif  algo.alert_read_status  == 1 %}
                                       <td><span class="badge bg-label-success me-1">Inactive</span></td>
                                        {% elif  algo.alert_read_status  == 2 %}
                                       <td><span class="badge bg-label-secondary me-1"> Pending</span></td>
                                        {% else %}
                                          <td><span class="badge bg-label-secondary me-1">No Status</span></td>
                                       {% endif %}

                                    <td class="statz">
                                      <a href="#" onclick="editalert('{{algo.priority}}','{{algo.camera}}','{{algo.alert_time}}','{{algo.alert_read_status}}','{{algo.image_path}}','{{algo.alert_id}}','{{algo.alert_title}}','{{algo.alert_date}}')" class="btn btn-sm btn-icon item-edit" data-bs-toggle="offcanvas" data-bs-target="#offcanvasEndedit" aria-controls="offcanvasEnd"><i  class="ti ti-edit"></i></a>                                               
                                      <a href="#" onclick="viewalert('{{algo.priority}}','{{algo.camera}}','{{algo.alert_time}}','{{algo.alert_read_status}}','{{algo.image_path}}','{{algo.alert_id}}','{{algo.alert_title}}','{{algo.alert_date}}')" class="btn btn-sm btn-icon item-view" data-bs-toggle="offcanvas" data-bs-target="#offcanvasEndview" aria-controls="offcanvasEnd"><i  class="ti ti-eye"></i></a>
                                    </td>
                                    </tr>
                                     {% endfor %}
                                 
                                  
                                </tbody>

                                
                              </table>
                            </div>

                            
                          
                          <div class="offcanvas w-500 offcanvas-end" tabindex="-1" id="offcanvasEndedit"
                            aria-labelledby="offcanvasEndLabel">
                              <div class="offcanvas-header">
                                <h5 id="offcanvasEndLabel" class="offcanvas-title">Edit Alert
                                </h5>
                                <button type="button" class="btn-close text-reset"
                                  data-bs-dismiss="offcanvas" aria-label="Close"></button>
                              </div>
                              <div class="offcanvas-body pt-2 mb-auto mx-0 flex-grow-0">

                                <form class="add-new-record pt-0 row g-2">
                                <div class="card-flex">
                                  <h5 class="card-title mb-1" id="title">People Count</h5>     
                                  <button type="button" class="badge bg-label-success mt-3 btn nousecaze waves-effect w-auto" id="buttonstatus"> Active </button>                                          
                                </div>

                                  <div class="col-sm-6 mb-2">
                                    <label class="form-label" for="basicFullname">Priority</label>
                                    <div class="input-group input-group-merge readz"> 
                                      <input type="text"  id="priority" class="form-control dt-full-name"  name="basicFullname"  placeholder="Enter Camera Name"  aria-label="John Doe"   aria-describedby="basicFullname2"  disabled />
                                    </div>
                                  </div> 
                                  <div class="col-sm-6 mb-2">
                                    <label class="form-label" for="basicFullname">Date Time</label>
                                    <div class="input-group input-group-merge readz"> 
                                      <input type="text"  id="time" class="form-control dt-full-name"  name="basicFullname"  placeholder="Enter Camera Name"  aria-label="John Doe"   aria-describedby="basicFullname2"  disabled />
                                    </div>
                                  </div>                                                  
                                  <div class="col-sm-12">
                                    <div class="viewhalfcamimg" >
                                      <img src="" alt="" id="editimage" >
                                    </div>
                                  </div>

                                  <div class="col-sm-6 mb-0">
                                    <label class="col-form-label" for="basicFullname">Assigned Camera</label>
                                    <div class="input-group input-group-merge readz"> 
                                      <input type="text"  id="cameraname" class="form-control dt-full-name"  name="basicFullname"  placeholder="Enter Camera Name"  aria-label="John Doe"   aria-describedby="basicFullname2" value="" disabled />
                                    </div>
                                  </div> 

                                  <div class="col-sm-6 mb-1">
                                    <label class="col-sm-12 col-form-label" for="multicol-username">Assigned To</label>
                                    <div class="col-sm-12">
                                      <select name="" id="" class="select2 form-select">
                                        <option value="admin">admin</option>
                                      </select>
                                    </div>
                                  </div>

                                  
                                  
                                  <div class="col-sm-6 mb-1">
                                    <div class="ecommerce-select2-dropdown">
                                      <label class="form-label" for="ecommerce-category-parent-category">Status</label>
                                      <select
                                        id="statuschange"
                                        class="select2 form-select"
                                        data-placeholder="Select parent category">
                                        <option value="0">Active </option>
                                        <option value="1">Inactive </option>
                                        <option value="2">Pending</option>
                                        <option value="3">On Hold</option>
                                        <option value="4">Completed</option>
                                        
                                        <option value="5">Closed</option>                                                
                                      </select>
                                    </div>
                                  </div>            

                                  <div class="col-sm-6 mb-3">
                                    <label class="form-label" for="basicPost">Resolve Comments</label>
                                    <div class="input-group input-group-merge">
                                      
                                      <input type="text"  id="basicPost" name="basicPost"  class="form-control dt-post"
                                        placeholder="Enter Comments"
                                        aria-label="Web Developer"
                                        aria-describedby="basicPost2" value="Issue has been resolved."/>
                                    </div>
                                  </div>


                                  <div class="col-sm-12">
                                    <hr>
                                  </div>

                                  <div class="col-sm-12">
                                    <button type="button" class="btn btn-primary me-sm-3 me-1" id="updatealert" data-bs-dismiss="offcanvas">Save Changes</button>  
                                    <button type="reset" class="btn btn-outline-secondary waves-effect" data-bs-dismiss="offcanvas">Cancel</button> 
                                  </div>                               
                                  <div class="col-sm-12">
                                    <hr>
                                  </div>
                                  <div class="accordion-body pt-3 pb-0">                                          
                                    <div class="d-flex align-items-center justify-content-between">
                                      <h6 class="mb-1">Audit History</h6>                                              
                                    </div>                                                                                     
                                    <ul class="timeline ps-3 mt-4 mb-0">
                                      <li class="timeline-item ms-1 ps-4 border-left-dashed">
                                        <span
                                          class="timeline-indicator-advanced timeline-indicator-success border-0 shadow-none">
                                          <i class="ti ti-circle-check"></i>
                                        </span>
                                        <div class="timeline-event ps-0 pb-0">
                                          <div class="timeline-header">
                                            <small class="text-success text-uppercase fw-medium"
                                              >Kevin Cook</small
                                            >
                                          </div>
                                          <h6 class="mb-1">Resolved Successfully</h6>
                                          <p class="text-muted mb-0">Sep 01, 7:53 AM</p>
                                        </div>
                                      </li>
                                      <li class="timeline-item ms-1 ps-4 border-left-dashed">
                                        <span
                                          class="timeline-indicator-advanced timeline-indicator-success border-0 shadow-none">
                                          <i class="ti ti-circle-check"></i>
                                        </span>
                                        <div class="timeline-event ps-0 pb-0">
                                          <div class="timeline-header">
                                            <small class="text-success text-uppercase fw-medium">John Thomas</small>
                                          </div>
                                          <h6 class="mb-1">Unwarranted Issue</h6>
                                          <p class="text-muted mb-0">Sep 03, 8:02 AM</p>
                                        </div>
                                      </li>
                                      <li class="timeline-item ms-1 ps-4 border-transparent">
                                        <span
                                          class="timeline-indicator-advanced timeline-indicator-primary border-0 shadow-none">
                                          <i class="ti ti-map-pin mt-1"></i>
                                        </span>
                                        <div class="timeline-event ps-0 pb-0">
                                          <div class="timeline-header">
                                            <small class="text-primary text-uppercase fw-medium">Sam</small>
                                          </div>
                                          <h6 class="mb-1">Resolved</h6>
                                          <p class="text-muted mb-0">Sep 04, 8:18 AM</p>
                                        </div>
                                      </li>
                                    </ul>
                                  </div>
                                </form>  
                              </div>
                          </div> 

                          <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasEndview"
                            aria-labelledby="offcanvasEndLabel">
                              <div class="offcanvas-header">
                                <h5 id="offcanvasEndLabel" class="offcanvas-title">View Alert
                                </h5>
                                <div> 
                                  <button type="button" class="btn-view-editz text-reset"data-bs-toggle="offcanvas" data-bs-target="#offcanvasEndedit" aria-controls="offcanvasEnd"><i  class="ti ti-edit"></i></button>
                                  <button type="button" class="btn-close text-reset"
                                  data-bs-dismiss="offcanvas" aria-label="Close"></button>
                                </div> 
                              </div>
                              <div class="offcanvas-body pt-2 mb-auto mx-0 flex-grow-0">

                                <form class="add-new-record pt-0 row g-2">
                                <div class="card-flex mb-2">
                                  <h5 class="card-title mb-1" id="titleview">People Count</h5>       
                                  <button type="button" class="badge bg-label-success mt-2 btn nousecaze waves-effect w-auto" id="buttonview"> Active </button>                                          
                                </div>                                          
                                  <div class="col-sm-6 mb-2">
                                    <label class="form-label" for="basicFullname">Priority </label>
                                    <div class="input-group input-group-merge readz"> 
                                      <input type="text"  id="priorityview" class="form-control dt-full-name"  name="basicFullname"  placeholder="Enter Camera Name"  aria-label="John Doe"   aria-describedby="basicFullname2"  disabled />
                                    </div>
                                  </div>
                                  <div class="col-sm-6 mb-2">
                                    <label class="form-label" for="basicPost">Date Time </label>
                                    <div class="input-group input-group-merge readz">
                                      
                                      <input type="text"  id="dateview" name="basicPost"  class="form-control dt-post"
                                        placeholder="Enter Priority"
                                        aria-label="Web Developer"
                                        aria-describedby="basicPost2" disabled />
                                    </div>
                                  </div>

                                  <div class="col-sm-12">
                                    <div class="viewhalfcamimg">
                                      <img src="" alt="" id="viewimage" >
                                    </div>
                                  </div>
                                  <div class="col-sm-12 mb-1">
                                    <label class="form-label" for="basicFullname">Assigned Camera </label>
                                    <div class="input-group input-group-merge readz"> 
                                      <input type="text"  id="cameraview" class="form-control dt-full-name"  name="basicFullname"  placeholder="Enter Camera Name"  aria-label="John Doe"   aria-describedby="basicFullname2" value="" disabled />
                                    </div>
                                  </div>
                                  <div class="col-sm-12 mb-1">
                                    <label class="form-label" for="basicFullname">Assigned To </label>
                                    <div class="input-group input-group-merge readz"> 
                                      <input type="text"  id="assigned" class="form-control dt-full-name"  name="basicFullname"  placeholder="Enter Camera Name"  aria-label="John Doe"   aria-describedby="basicFullname2" value="" disabled />
                                    </div>
                                  </div>
                                  <div class="col-sm-12 mb-0">
                                    <label class="form-label" for="basicFullname">Resolve Comment</label>
                                    <div class="input-group input-group-merge readz"> 
                                      <input type="text"  id="basicFullname" class="form-control dt-full-name"  name="basicFullname"  placeholder="Enter Camera Name"  aria-label="John Doe"   aria-describedby="basicFullname2" value="Issue has been resolved" disabled />
                                    </div>
                                  </div>

                                  <div class="col-sm-12">
                                    <hr>
                                  </div>

                                  <div class="col-sm-12"> 
                                    <!--button type="reset" class="btn btn-outline-secondary waves-effect" data-bs-dismiss="offcanvas">Cancel</button--> 
                                  </div>
                                  <div class="accordion-body pt-3 pb-0">                                          
                                    <div class="d-flex align-items-center justify-content-between">
                                      <h6 class="mb-1">Audit History</h6>                                              
                                    </div>                                                                                     
                                    <ul class="timeline ps-3 mt-4 mb-0">
                                      <li class="timeline-item ms-1 ps-4 border-left-dashed">
                                        <span
                                          class="timeline-indicator-advanced timeline-indicator-success border-0 shadow-none">
                                          <i class="ti ti-circle-check"></i>
                                        </span>
                                        <div class="timeline-event ps-0 pb-0">
                                          <div class="timeline-header">
                                            <small class="text-success text-uppercase fw-medium"
                                              >Kevin Cook</small
                                            >
                                          </div>
                                          <h6 class="mb-1">Resolved Successfully</h6>
                                          <p class="text-muted mb-0">Sep 01, 7:53 AM</p>
                                        </div>
                                      </li>
                                      <li class="timeline-item ms-1 ps-4 border-left-dashed">
                                        <span
                                          class="timeline-indicator-advanced timeline-indicator-success border-0 shadow-none">
                                          <i class="ti ti-circle-check"></i>
                                        </span>
                                        <div class="timeline-event ps-0 pb-0">
                                          <div class="timeline-header">
                                            <small class="text-success text-uppercase fw-medium">John Thomas</small>
                                          </div>
                                          <h6 class="mb-1">Unwarranted Issue</h6>
                                          <p class="text-muted mb-0">Sep 03, 8:02 AM</p>
                                        </div>
                                      </li>
                                      <li class="timeline-item ms-1 ps-4 border-transparent">
                                        <span
                                          class="timeline-indicator-advanced timeline-indicator-primary border-0 shadow-none">
                                          <i class="ti ti-map-pin mt-1"></i>
                                        </span>
                                        <div class="timeline-event ps-0 pb-0">
                                          <div class="timeline-header">
                                            <small class="text-primary text-uppercase fw-medium">Sam</small>
                                          </div>
                                          <h6 class="mb-1">Resolved</h6>
                                          <p class="text-muted mb-0">Sep 04, 8:18 AM</p>
                                        </div>
                                      </li>
                                    </ul>
                                  </div>
                                </form>  
                              </div>
                          </div> 

                          </div>
                        </div>
                    </div>
                  </div>
              </div>
              </div>
            </div>
          </div>
      </div>
</div>      




<script>
  
    $(document).ready(function() {
     $('.enshow').hide();
   // Listen for changes on the switch input
   $('.enswitch').change(function() {
     // Check if the switch is checked
     if ($(this).is(':checked')) {
       // If checked, show the .enshow div
       $('.enshow').show();
     } else {
       // If unchecked, hide the .enshow div
       $('.enshow').hide();
     }
   });




  
  
 </script>
{% endblock %}


{% block js %}
  <!-- build:js assets/vendor/js/core.js -->

    <script src="{{static}}assets/vendor/libs/jquery/jquery.js"></script>
    <script src="{{static}}assets/vendor/libs/popper/popper.js"></script>
    <script src="{{static}}assets/vendor/js/bootstrap.js"></script>
    <script src="{{static}}assets/vendor/libs/node-waves/node-waves.js"></script>
    <script src="{{static}}assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="{{static}}assets/vendor/libs/hammer/hammer.js"></script>
    <script src="{{static}}assets/vendor/libs/i18n/i18n.js"></script>
    <script src="{{static}}assets/vendor/libs/typeahead-js/typeahead.js"></script>
    <script src="{{static}}assets/vendor/js/menu.js"></script>

    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="{{static}}assets/vendor/libs/apex-charts/apexcharts.js"></script>
    <script src="{{static}}assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
    <script src="{{static}}assets/vendor/libs/cleavejs/cleave.js"></script>
    <script src="{{static}}assets/vendor/libs/cleavejs/cleave-phone.js"></script>
    <script src="{{static}}assets/vendor/libs/bs-stepper/bs-stepper.js"></script>
    <script src="{{static}}assets/vendor/libs/select2/select2.js"></script>
    <script src="{{static}}assets/vendor/libs/tagify/tagify.js"></script>
    <script src="{{static}}assets/vendor/libs/bootstrap-select/bootstrap-select.js"></script>
    <script src="{{static}}assets/vendor/libs/typeahead-js/typeahead.js"></script>
    <script src="{{static}}assets/vendor/js/menu.js"></script>
    <script src="{{static}}assets/vendor/libs/bloodhound/bloodhound.js"></script>

    <script src="{{static}}assets/vendor/libs/@form-validation/popular.js"></script>
    <script src="{{static}}assets/vendor/libs/@form-validation/bootstrap5.js"></script>
    <script src="{{static}}assets/vendor/libs/@form-validation/auto-focus.js"></script>

    <script src="{{static}}assets/vendor/libs/sweetalert2/sweetalert2.js"></script> 






    <script src="{{static}}assets/vendor/libs/jquery-timepicker/jquery-timepicker.js"></script>
    <script src="{{static}}assets/vendor/libs/flatpickr/flatpickr.js"></script>
  
  
  
    <script src="{{static}}assets/vendor/libs/moment/moment.js"></script>
    <script src="{{static}}assets/vendor/libs/flatpickr/flatpickr.js"></script>
    <script src="{{static}}assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.js"></script>
    <script src="{{static}}assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.js"></script>
    <script src="{{static}}assets/vendor/libs/jquery-timepicker/jquery-timepicker.js"></script>
    <script src="{{static}}assets/vendor/libs/pickr/pickr.js"></script>
    <!-- Main JS -->
    <script src="{{static}}assets/js/main.js"></script>

    <!-- Page JS -->

    <script src="{{static}}assets/js/forms-selects.js"></script>
    <script src="{{static}}assets/js/forms-tagify.js"></script>
    <script src="{{static}}assets/js/forms-typeahead.js"></script>

    <script src="{{static}}assets/js/app-logistics-dashboard.js"></script>
    <script src="{{static}}assets/js/extended-ui-sweetalert2.js"></script>
   
    <script src="{{static}}assets/js/forms-selects.js"></script> 
    <script src="{{static}}assets/js/form-wizard-icons.js"></script> 

    <script src="{{static}}assets/js/tables-datatables-basic.js"></script>




    <script src="{{static}}assets/js/forms-pickers.js"></script>
    <script type="text/javascript">

      var editid;
      setInterval(() => {
          getalertupdate('e');
      }, 3000);
      
      let datearry = [];
      var flatpickrRange = document.querySelector('#flatpickr-range');
      
      if (flatpickrRange) {
          const dateRangePicker = flatpickr(flatpickrRange, {
              mode: 'range',
              dateFormat: 'Y-m-d', // Set your desired date format
              maxDate: new Date(), // Prevent future dates from being selected
              onChange: function (selectedDates, dateStr, instance) {
                  datearry = selectedDates;
                  if (selectedDates.length === 1) {
                      // When the first date is selected, set the maximum selectable date to 7 days from the start date
                      var startDate = selectedDates[0];
                      var maxEndDate = new Date(startDate.getTime() + (6 * 24 * 60 * 60 * 1000));
                      instance.set('maxDate', maxEndDate > new Date() ? new Date() : maxEndDate);
                  } else if (selectedDates.length === 2) {
                      // When the second date is selected, check if the range is more than 7 days
                      var diff = (selectedDates[1] - selectedDates[0]) / (1000 * 60 * 60 * 24);
                      if (diff > 7) {
                          // Reset the end date to 7 days from the start date
                          var newEndDate = new Date(selectedDates[0].getTime() + (6 * 24 * 60 * 60 * 1000));
                          instance.setDate([selectedDates[0], newEndDate], false);
                      }
                      // Reset maxDate to the default value (optional)
                      instance.set('maxDate', new Date());
                  }
              }
          });
      }
      


   var update="false"
   function getalertupdate(type) 
   {
    
     //camera=$("#camera").val()
     camera=$('#camera option:selected').text();
     //date=$("#flatpickr-range").val()
      algorithm=$("#algorithm").val()
       const startDate = datearry[0];
      const endDate = datearry[1];
      const datesArray = getDatesArray(startDate, endDate);
      console.log(datesArray);
     
     if($("#camera").val() == 0)
     {
       cameraval="None"
     }
     else{
        cameraval=camera
     }
     if(algorithm == 0)
     {
       algorithmval="None"
     }
     else{
        algorithmval=algorithm
     }

   if(datesArray.length == 0)
     {
       dateval="None"
     }
     else{
        dateval=datesArray
     }

      var formData = new FormData();
       if(dateval=="None")
       {
 formData.append("date",dateval)
       }
       else{
         formData.append("date",JSON.stringify(dateval))
       }
       
         formData.append("camera",cameraval)
          formData.append("algorithm_name",algorithmval)
          if(type == 'r')
          {
             formData.append("filter_status","False")
          }
          else{
             formData.append("filter_status","True")
          }
         
          formData.append("update",update)
              $.ajax({
           url: "alertstatus",
           type: 'POST',
           data: formData,                
             success: function(result){ 
                update="false"
           
            //if(result.check == 1 ||result.check == "1" )
            if(result.update == "true")
            {

            // $("#alerttabletbody").empty();
             $("#total").text(result.total)
              $("#active").text(result.active)
               $("#inactive").text(result.inactive)
                $("#pending").text(result.pending)
                if ( $.fn.DataTable.isDataTable('#alerttable') ) {
  $('#alerttable').DataTable().destroy();
}

             $('#alertable tbody').empty();
             const tbody = document.querySelector('#alerttable tbody');

             if( result.resultdata.length == 0)
             {
                   tbody.innerHTML = "No Data";
             }
             else{
              var k = '<tbody>';
              for (var i = 0; i < result.resultdata.length; i++) 
              {

              k+= '<tr>';
              k+= '<td>' + result.resultdata[i]["priority"] + '</td>'
               k+= '<td>' + result.resultdata[i]["alert_title"] + '</td>'
                k+= '<td>' + result.resultdata[i]["camera"] + '</td>'
                 k+= '<td>' + result.resultdata[i]["alert_date"] + '</td>'
                  k+= '<td>' + result.resultdata[i]["alert_time"] + '</td>'
                   k+= '<td>' +'{{request.user.username}}' + '</td>'
                   if(result.resultdata[i]["alert_read_status"] == 0)
                   {
                       k+= '<td><span class="badge bg-label-success me-1">Active</span></td>'
                   }
                   else if(result.resultdata[i]["alert_read_status"] == 1)
                   {
                     k+= '<td><span class="badge bg-label-success me-1">Inactive</span></td>'
                   }
                   else if(result.resultdata[i]["alert_read_status"] == 2)
                   {
                     k+= '<td><span class="badge bg-label-secondary me-1">Pending</span></td>'
                   }
                   else{
                       k+= '<td><span class="badge bg-label-secondary me-1">No Status</span></td>'
                   }
                  
k+='<td class="statz">'+
'<a href="#" onclick="editalert('+result.resultdata[i]["priority"]+','+result.resultdata[i]["camera"]+','+result.resultdata[i]["alert_time"]+','+result.resultdata[i]["alert_read_status"]+','+result.resultdata[i]["image_path"]+','+result.resultdata[i]["alert_id"]+','+result.resultdata[i]["alert_title"]+','+result.resultdata[i]["alert_date"]+')" class="btn btn-sm btn-icon item-edit" '+
'data-bs-toggle="offcanvas" data-bs-target="#offcanvasEndedit" '+
'aria-controls="offcanvasEnd"><i  class="ti ti-edit"></i></a><a href="#" '+
'onclick="viewalert('+result.resultdata[i]["priority"]+','+result.resultdata[i]["camera"]+','+result.resultdata[i]["alert_time"]+','+result.resultdata[i]["alert_read_status"]+','+result.resultdata[i]["image_path"]+','+result.resultdata[i]["alert_id"]+','+result.resultdata[i]["alert_title"]+','+result.resultdata[i]["alert_date"]+')" class="btn btn-sm btn-icon item-view" data-bs-toggle="offcanvas"'+ 
 'data-bs-target="#offcanvasEndview" aria-controls="offcanvasEnd">'+
 '<i class="ti ti-eye"></i></a></td>'

                   }
              k+= '</tr>';
              
              k+='</tbody>';
               tbody.innerHTML = k;
              $('#alerttable').DataTable( {
         select: true,
       // select: true,
    } ); 
             }
            
           alertflagupdation()    
        }         
                },
                error: function(error){
  
                 
  console.log(error)
                   
  
                },
                 cache: false,
           contentType: false,
           processData: false
  
  
           });
            


   }
function editalert(priority,camera,alerttime,readstatus,image_path,alertid,title,date)
{
 editid=alertid
$("#title").text(title)
$("#cameraname").val(camera)
$("#buttonstatus").text(readstatus)
$("#statuschange").val(readstatus)
$('#statuschange').trigger('change');

  $('#editimage').attr('src',"/media/"+image_path); 
  $("#priority").val(priority)
 // $('#statuschange').select2();

    // Set the selected value using Select2 method
   // $('#statuschange').val(readstatus).trigger('change');
  $("#time").val(date+" " +alerttime) // Change image source
  if(readstatus == 0)
  {
   $("#buttonstatus").text("Active")

  }
  else if(readstatus == 1)
  {
   $("#buttonstatus").text("Inactive")

  }
  else if(readstatus == 2)
  {
   $("#buttonstatus").text("Pending")

  }
  else if(readstatus == 3)
  {
   $("#buttonstatus").text("On Hold")

  }
  else if(readstatus == 4)
  {
   $("#buttonstatus").text("Completed")

  }
  else if(readstatus == 5)
  {
   $("#buttonstatus").text("Closed")

  }
  
  

}
function viewalert(priority,camera,alerttime,readstatus,image_path,alertid,title,date)
{

  $("#titleview").text(title)
$("#cameraview").val(camera)

$("#assigned").val('{{request.user.username}}')
  $('#viewimage').attr('src',"/media/"+image_path ); 
  $("#priorityview").val(priority)
  $("#dateview").val(date+" " +alerttime) // Change image source
  if(readstatus == 0)
  {
   $("#buttonview").text("Active")

  }
  else if(readstatus == 1)
  {
   $("#buttonview").text("Inactive")

  }
  else if(readstatus == 2)
  {
   $("#buttonview").text("Pending")

  }
  else if(readstatus == 3)
  {
   $("#buttonview").text("On Hold")

  }
  else if(readstatus == 4)
  {
   $("#buttonview").text("Completed")

  }
  else if(readstatus == 5)
  {
   $("#buttonview").text("Closed")

  }
  

}

 var updatealert = document.getElementById('updatealert');



    // Add event listener to the button
    updatealert.addEventListener('click', function() {
       
      
  
        // Show Swal dialog
         Swal.fire({
          title: 'Are you Sure?',
          text: 'Alert status will be updated',
          icon: 'success', 
        showCancelButton: true,
        confirmButtonText: 'Yes, Submit',
        customClass: {
          confirmButton: 'btn btn-primary me-3 waves-effect waves-light',
          cancelButton: 'btn btn-label-secondary waves-effect waves-light'
        },
        buttonsStyling: false 
        }).then((result) => {
            // If user confirms the action
            if (result.isConfirmed) {
             
        var formData = new FormData();
                // Call your AJAX function here
        
        formData.append("status_alert_id",editid)
         formData.append("status_new_val",$("#statuschange").val())
                $.ajax({
           url: "updatealert",
           type: 'POST',
           data: formData,
              //data: { casename: caseName,filename: filenames} ,                   
             success: function(result){ 
              
              update="true"
               getalertupdate('e')
                 
                },
                error: function(error){
  
  
                   
  
                },
                 cache: false,
           contentType: false,
           processData: false
  
  
           });
            }
            });

      
    }); 

    function alertflagupdation() 
    {

        var formData = new FormData();
                // Call your AJAX function here
        
        formData.append("flag",0)
                $.ajax({
           url: "alertflag_updation",
           type: 'POST',
           data: formData,
              //data: { casename: caseName,filename: filenames} ,                   
             success: function(result){ 
              },
                   cache: false,
           contentType: false,
           processData: false
            });

    } 
    function searchalert()
    {
      camera=$("#camera").val()
      algorithm=$("#algorithm").val()

     
      const startDate = datearry[0];
      const endDate = datearry[1];
      const datesArray = getDatesArray(startDate, endDate);
      console.log(datesArray);
     
     

     if(camera == 0 && algorithm == 0 && datesArray.length == 0 )
     {

      alert("Please select values for search")
      }
      else{
        update="true"
        getalertupdate('e')
      }

    }
    function refresh()
    {
      
      $("#camera").val(0)
      $('#camera').trigger('change');
       $("#flatpickr-date").val("")
       dateRangePicker.clear();
       $("#algorithm").val(0)
         $('#algorithm').trigger('change');
         datearry=[]
        update="true"
        getalertupdate('r')
    }
   
function getDatesArray(startDate, endDate) {
    const date = new Date(startDate);
    const dates = [];

    while (date <= endDate) {
      dates.push(formatDate(date));
      date.setDate(date.getDate() + 1);
    }

    return dates;
  }
   function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }



      
    </script>
{% endblock %}